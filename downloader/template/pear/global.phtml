<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * @category   Varien
 * @package    Varien_Object
 * @copyright  Copyright (c) 2004-2007 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<?php echo $this->template('header.phtml') ?>

<h2 class="page-head">Global Install/Upgrade</h2>

<fieldset>
<?php if ($this->controller()->session()->getUserId()): ?>
    <button onclick="upgradeAll()">Upgrade All Available Packages</button>
<?php else: ?>
    <button onclick="installAll()">Install All Magento Core Packages</button>
<?php endif; ?>
</fieldset>
<br/>
<?php echo $this->template('pear/iframe.phtml') ?>
<a name="pear_iframe_result"></a>
<div id="pear_iframe_success" style="display:none">
<?php if ($this->controller()->session()->getUserId()): ?>
    <?php $this->set('messages', array('success'=>array('Upgrade completed. Please check the output frame for useful information and refresh the page to see changes.'))) ?>
    <?php echo $this->template('messages.phtml') ?>
    <button onclick="location.reload()">Refresh</button>
<?php else: ?>
    <?php $this->set('messages', array('success'=>array(
       'Download completed. Please check the output frame for useful information and refresh the page to see changes.',
       'Alternatively you may proceed to Magento Installation wizard',
    ))) ?>
    <?php echo $this->template('messages.phtml') ?>
    <button onclick="location.reload()">Refresh</button>
    <button onclick="location.href='<?php echo $this->mageUrl() ?>'">Proceed to Magento Installation Wizard</button>
<?php endif; ?>
</div>
<div id="pear_iframe_failure" style="display:none">
    <?php $this->set('messages', array('error'=>array('There was a problem during downloading of Magento packages. Please check the output frame for errors information and refresh the page to retry again.'))) ?>
    <?php echo $this->template('messages.phtml') ?>
    <button onclick="location.reload()">Refresh</button>
</div>

<script type="text/javascript">
function installAll()
{
    onSubmit();
    $('pear_iframe').src = '<?php echo $this->url('pearInstallAll') ?>';
}

function upgradeAll()
{
    onSubmit();
    $('pear_iframe').src = '<?php echo $this->url('pearUpgradeAll') ?>';
}
</script>
<?php echo $this->template('footer.phtml') ?>

