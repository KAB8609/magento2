<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php /** @var $this Enterprise_Invitation_Block_Form */?>
<div class="page-title">
    <h1><?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('Send Invitations') ?></h1>
</div>
<div id="messages"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
<?php echo $this->getChildHtml('form_before')?>
<?php $maxPerSend = $this->getMaxInvitationsPerSend(); ?>
<?php if ($maxPerSend): ?>
<form id="invitationForm" action="" method="post">
    <div class="fieldset">
    <h2 class="legend"><?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('Invite your friends by entering their email addresses.'); ?></h2>
        <ul class="form-list">
            <?php $_perRow = ceil($maxPerSend/3); for($_index = 1; $_index <= $maxPerSend; $_index ++): ?>
            <li>
                <label for="email_<?php echo $_index ?>"<?php if ($_index == 1) echo ' class="required"' ?>><?php if ($_index == 1) echo '<em>*</em>' ?><?php echo $_index; ?>:</label>
                <div class="input-box">
                    <input tabindex="<?php echo $_index ?>" name="email[]" id="email_<?php echo $_index ?>" title="<?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('Email') ?>" value="" class="input-text" type="text" data-validate="{'validate-email':true<?php if ($_index == 1): ?>, required:true<?php endif;?>}" />
                </div>
            </li>
            <?php endfor; ?>
        <?php if ($this->isInvitationMessageAllowed()): ?>
            <li>
                <label for="message"><?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('Message');?>: </label>
                <div class="input-box">
                    <textarea tabindex="<?php echo $_index+1 ?>" name="message" id="message" title="<?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('Message') ?>"  class="input-text" rows="5" cols="5"></textarea>
                </div>
            </li>
        </ul>
        <?php endif;?>
    </div>
   <p class="required"><?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('* Required Fields') ?></p>
    <div class="buttons-set form-buttons">
        <p class="back-link"><a href="<?php echo $this->helper('Enterprise_Invitation_Helper_Data')->getCustomerInvitationUrl() ?>"><small>&laquo; </small><?php  echo $this->helper('Enterprise_Invitation_Helper_Data')->__('Back to Invitations') ?></a></p>
        <button class="button" type="submit"><span><span><?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('Send Invitations') ?></span></span></button>
    </div>

</form>
<script type="text/javascript">
    (function($) {
        head.js(
            "<?php echo $this->getViewFileUrl('jquery/jquery.validate.js') ?>",
            "<?php echo $this->getViewFileUrl('jquery/jquery.metadata.js') ?>",
            "<?php echo $this->getViewFileUrl('mage/validation.js')?>",
            "<?php echo $this->getViewFileUrl('mage/validation/validation.js') ?>",
            function() {
                /**
                 * All input fields have the same name attribute 'email[]',
                 * by default jQuery validate only validate the first input field.
                 * We overwrite checkForm function to validate all the input fields.
                 * This maybe a use case to have a beforeValidation event?
                 */
                $.extend($.validator.prototype, {checkForm: function() {
                    this.prepareForm();
                    this.findByName(this.elements()[0].name).each($.proxy(function(i, e) {
                        this.check(e);
                    }, this));
                    return this.valid();
                }});
                $('#invitationForm').validation({});
            });
    })(jQuery);
</script>
<?php else:?>
<p><?php echo $this->helper('Enterprise_Invitation_Helper_Data')->__('You cannot send more invitations'); ?></p>
<?php endif; ?>
