<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>

<script id="template-registrant" type="text/x-jQuery-tmpl">
    <input name="registrant[${_index_}][person_id]" value="" id="registrant:person_id${_index_}" type="hidden" />
    <p class="btn-remove" id="btn-remove${_index_}"><a href="#" class="btn-remove">
        <img src="<?php echo $this->getViewFileUrl('images/btn_remove.gif') ?>" alt="<?php echo __('Remove') ?>" /></a>
    </p>
    <div class="field">
        <label for="registrant:firstname${_index_}" class="required"><em>*</em><?php echo __('First Name:') ?></label>
        <div class="input-box">
            <input name="registrant[${_index_}][firstname]" value="" type="text" class="input-text" data-validate="{required:true}" id="registrant:firstname${_index_}" />
        </div>
    </div>
    <div class="field">
        <label for="registrant:lastname${_index_}" class="required"><em>*</em><?php echo __('Last Name:') ?></label>
        <div class="input-box">
            <input name="registrant[${_index_}][lastname]" value="" type="text" class="input-text" data-validate="{required:true}" id="registrant:lastname${_index_}" />
        </div>
    </div>
    <div class="field">
        <label for="registrant:email${_index_}" class="required"><em>*</em><?php echo __('Email Address:') ?></label>
        <div class="input-box">
            <input name="registrant[${_index_}][email]" value="" title="<?php echo __('Email Address') ?>" id="registrant:email${_index_}" type="text" class="input-text" data-validate="{required:true,'validate-email':true}"  />
        </div>
    </div>

    <?php foreach ($this->getGroupedRegistrantAttributes() as $field => $data) : ?>
    <?php $isRequired = $this->isAttributeRequired($data); ?>
    <?php $isStatic = $this->isAttributeStatic($field); ?>
        <div class="field">
            <label for="registrant:<?php if (!$isStatic):?>custom:<?php endif;?><?php echo $field ?>${_index_}" <?php echo ($isRequired ? 'class="required"' : '') ?>>
                <?php echo ($isRequired ? '<em>*</em>' : '') . __("%s", $data['label']) ?>
            </label>
            <div class="input-box">
                <?php echo $this->renderField($data, $field, '{{' . $field . '_value}}') ?>
            </div>
        </div>
    <?php endforeach; ?>
</script>
<div class="fieldset">
    <h2 class="legend"><?php echo __('Recipients Information') ?></h2>
    <ul class="form-list" id="registrant-container">
        <li class="no-display">&nbsp;</li>
    </ul>
    <div class="buttons-set form-buttons">
        <p class="back-link">
            <span id="max-registrant-message" style="display:none;">
                <?php if ($this->getMaxRegistrant()): ?>
                    <?php echo __('Maximum %d recipients.', $this->getMaxRegistrant()) ?>
                <?php endif; ?>
            </span>&nbsp;
        </p>
        <?php if (1 < $this->getMaxRegistrant()): ?>
            <button type="button" id="add-registrant-button" class="button"><span><span><?php echo __('Add Recipient') ?></span></span></button>
        <?php endif; ?>
    </div>
</div>

<script type="text/javascript">
    head.js("<?php echo $this->getViewFileUrl('jquery/jquery.tmpl.min.js')?>",
        "<?php echo $this->getViewFileUrl('jquery/jquery.validate.js')?>",
        "<?php echo $this->getViewFileUrl('jquery/jquery.metadata.js')?>",
        "<?php echo $this->getViewFileUrl('mage/validation.js')?>",
        "<?php echo $this->getViewFileUrl('mage/validation/validation.js')?>",
        "<?php echo $this->getViewFileUrl('Mage_Page::js/row-builder.js')?>",
        "<?php echo $this->getViewFileUrl('Enterprise_GiftRegistry::gift-registry.js')?>", function() {
            jQuery('#form-validate').giftRegistry({
                maxRows: '<?php echo $this->getMaxRegistrant() ?>',
                formDataPost: {"formData": <?php echo json_encode($this->getRegistrantPresets($this->getEntity()->getId())); ?>}
            });
        });
</script>
