<?xml version="1.0"?>
<!--
/**
 * {license_notice}
 *
 * @category    design
 * @package     default_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
-->

<layout>
    <adminhtml_customer_edit>
        <reference name="customer_edit_tabs">
            <block type="Enterprise_Reward_Block_Adminhtml_Customer_Edit_Tab_Reward" name="customer_edit_tab_reward" template="customer/reward.phtml">
                <block type="Enterprise_Reward_Block_Adminhtml_Customer_Edit_Tab_Reward_Management" name="reward_management"/>
            </block>
            <action method="addTab"><name>customer_edit_tab_reward</name><block>customer_edit_tab_reward</block></action>
        </reference>
        <reference name="customer_edit_tab_view">
            <block type="Enterprise_Reward_Block_Adminhtml_Customer_Edit_Tab_Reward_Management_Balance" name="reward.points.balance" before="-"/>
        </reference>
    </adminhtml_customer_edit>

    <adminhtml_reward_rate_index>
        <reference name="content">
            <block type="Enterprise_Reward_Block_Adminhtml_Reward_Rate" name="reward.rate.container"/>
        </reference>
    </adminhtml_reward_rate_index>

    <adminhtml_reward_rate_edit>
        <reference name="content">
            <block type="Enterprise_Reward_Block_Adminhtml_Reward_Rate_Edit" name="reward.rate.edit.container"/>
        </reference>
    </adminhtml_reward_rate_edit>

    <adminhtml_sales_order_create_index>
        <reference name="billing_method">
            <block type="Enterprise_Reward_Block_Adminhtml_Sales_Order_Create_Payment" template="sales/order/create/payment.phtml" name="reward_points" before="-" />
        </reference>
    </adminhtml_sales_order_create_index>
    
    <adminhtml_sales_order_create_load_block_billing_method>
        <reference name="billing_method">
            <block type="Enterprise_Reward_Block_Adminhtml_Sales_Order_Create_Payment" template="sales/order/create/payment.phtml" name="reward_points" before="-" />
        </reference>
    </adminhtml_sales_order_create_load_block_billing_method>

    <adminhtml_sales_order_create_load_block_data>
        <reference name="billing_method">
            <block type="Enterprise_Reward_Block_Adminhtml_Sales_Order_Create_Payment" template="sales/order/create/payment.phtml" name="reward_points" before="-" />
        </reference>
    </adminhtml_sales_order_create_load_block_data>

    <adminhtml_sales_order_view>
        <reference name="order_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward_points" template="Enterprise_Reward::sales/order/total.phtml">
                <action method="setBeforeCondition"><condition>customerbalance</condition></action>
            </block>
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward.points.refunded" template="Enterprise_Pbridge::sales/order/refunded.phtml">
                <action method="setDisplayArea"><area>footer</area></action>
                <action method="setAfterCondition"><condition>last</condition></action>
            </block>
        </reference>
    </adminhtml_sales_order_view>

    <adminhtml_sales_order_invoice_new>
        <reference name="invoice_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward_points" template="Enterprise_Pbridge::sales/order/total.phtml">
                <action method="setBeforeCondition"><condition>customerbalance</condition></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_new>

    <adminhtml_sales_order_invoice_updateqty>
        <reference name="invoice_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward_points" template="Enterprise_Pbridge::sales/order/total.phtml">
                <action method="setBeforeCondition"><condition>customerbalance</condition></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_updateqty>

    <adminhtml_sales_order_invoice_view>
        <reference name="invoice_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward_points" template="Enterprise_Pbridge::sales/order/total.phtml">
                <action method="setBeforeCondition"><condition>customerbalance</condition></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_view>

    <adminhtml_sales_order_creditmemo_new>
        <reference name="creditmemo_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward_points" template="Enterprise_Pbridge::sales/order/total.phtml">
                <action method="setBeforeCondition"><condition>customerbalance</condition></action>
            </block>
        </reference>
        <reference name="submit_before">
            <block type="Enterprise_Reward_Block_Adminhtml_Sales_Order_Creditmemo_Reward" name="reward_points" template="sales/order/creditmemo/reward.phtml" />
        </reference>
    </adminhtml_sales_order_creditmemo_new>

    <adminhtml_sales_order_creditmemo_updateqty>
        <reference name="creditmemo_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward_points" template="Enterprise_Pbridge::sales/order/total.phtml">
                <action method="setBeforeCondition"><condition>customerbalance</condition></action>
            </block>
        </reference>
        <reference name="submit_before">
            <block type="Enterprise_Reward_Block_Adminhtml_Sales_Order_Creditmemo_Reward" name="reward_points" template="sales/order/creditmemo/reward.phtml" />
        </reference>
    </adminhtml_sales_order_creditmemo_updateqty>

    <adminhtml_sales_order_creditmemo_view>
        <reference name="creditmemo_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="reward.points.refunded" template="Enterprise_Pbridge::sales/order/refunded.phtml">
                <action method="setDisplayArea"><area>footer</area></action>
                <action method="setBeforeCondition"><condition>customerbalance_refunded</condition></action>
            </block>
        </reference>
    </adminhtml_sales_order_creditmemo_view>

</layout>
