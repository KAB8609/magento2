<?xml version="1.0"?>
<!--
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
-->

<layout>
    <adminhtml_cms_page_index>
        <reference name="cms_page">
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page" name="cms_page_extender" />
        </reference>
    </adminhtml_cms_page_index>

    <adminhtml_cms_page_edit>
        <reference name="cms_page_edit_tabs">
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Edit" name="cms_page_edit_extender" />
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Edit_Tab_Hierarchy" name="cms_page_edit_tab_hierarchy" template="page/tab/hierarchy.phtml"></block>
            <action method="addTab"><name>hierarchy</name><block>cms_page_edit_tab_hierarchy</block></action>
        </reference>
    </adminhtml_cms_page_edit>
<!--
    Custom layout changes to native adminhtml_cms_page_edit handle
-->
    <adminhtml_cms_page_edit_changes>
        <reference name="head">
            <action method="addItem"><type>skin_js</type><name>Enterprise_Cms::cms.js</name></action>
        </reference>
        <reference name="cms_page_edit_tabs">
            <action method="removeTab"><name>content_section</name></action>
            <action method="removeTab"><name>design_section</name></action>
            <action method="removeTab"><name>meta_section</name></action>
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Edit_Tab_Versions" name="cms_page_edit_tab_versions" />
            <action method="addTab"><name>versions</name><block>cms_page_edit_tab_versions</block></action>
        </reference>
    </adminhtml_cms_page_edit_changes>

<!--
    Grid with versions on tab versions
-->
    <adminhtml_cms_page_versions>
        <remove name="root" />
        <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Edit_Tab_Versions"  output="toHtml" name="cms_page_edit_versions" />
        <update handle="formkey" />
    </adminhtml_cms_page_versions>

<!--
    Revision edit interface
-->
    <adminhtml_cms_page_revision_edit>
        <update handle="editor"/>
        <reference name="head">
            <action method="addItem"><type>skin_js</type><name>Enterprise_Cms::cms.js</name></action>
        </reference>
        <reference name="content">
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Revision_Edit" name="cms_page_revision_edit">
                <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Revision_Edit_Info" name="revision_info" template="page/revision/info.phtml" />
            </block>
        </reference>
        <reference name="left">
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Revision_Edit_Tabs" name="cms_page_revision_edit_tabs">
                <action method="addTab"><name>content_section</name><block>Enterprise_Cms_Block_Adminhtml_Cms_Page_Revision_Edit_Tab_Content</block></action>
                <action method="addTab"><name>design_section</name><block>Enterprise_Cms_Block_Adminhtml_Cms_Page_Revision_Edit_Tab_Design</block></action>
                <action method="addTab"><name>meta_section</name><block>Enterprise_Cms_Block_Adminhtml_Cms_Page_Revision_Edit_Tab_Meta</block></action>
            </block>
        </reference>
    </adminhtml_cms_page_revision_edit>

<!--
    Revision preview page
-->
    <adminhtml_cms_page_revision_preview>
        <reference name="root">
            <action method="setTemplate"><template>Enterprise_Cms::page/preview.phtml</template></action>
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Preview_Form" name="preview_form" />
            <block type="Mage_Core_Block_Text_List" name="tools" as="tools">
                <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Preview_Store" name="store_switcher" template="page/preview/store.phtml" />
                <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Preview_Revision" name="revision_switcher" template="page/preview/revision.phtml" />
                <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Preview_Buttons" name="preview_control_buttons" />
            </block>
        </reference>
    </adminhtml_cms_page_revision_preview>

<!--
    Version edit interface
-->
    <adminhtml_cms_page_version_edit>
        <reference name="content">
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Version_Edit" name="cms_page_version_edit">
                <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Version_Edit_Revisions" name="cms_page_version_edit_revisions_grid" />
            </block>
        </reference>
    </adminhtml_cms_page_version_edit>

<!--
    Grid with revisions on version edit page
-->
    <adminhtml_cms_page_version_revisions>
        <remove name="root" />
        <block type="Enterprise_Cms_Block_Adminhtml_Cms_Page_Version_Edit_Revisions"  output="toHtml" name="cms_page_edit_version_edit_revisions" />
    </adminhtml_cms_page_version_revisions>

<!--
    Main Page of Hierarchy Editor
-->
    <adminhtml_cms_hierarchy_index>
        <reference name="head">
            <action method="setCanLoadExtJs"><flag>1</flag></action>
        </reference>
        <reference name="content">
            <block type="Enterprise_Cms_Block_Adminhtml_Cms_Hierarchy_Edit" name="enterprise_cms_hierarchy_edit_tree">
                <block type="Enterprise_Cms_Block_Adminhtml_Cms_Hierarchy_Edit_Form_Grid" name="cms_page_grid" />
            </block>
        </reference>
        <block type="Mage_Adminhtml_Block_Store_Switcher" name="store_switcher" />
    </adminhtml_cms_hierarchy_index>

<!--
    Adding ExtJs scripts on cms page edit page for tree functionality
-->
    <adminhtml_cms_page_edit>
        <reference name="head">
            <action method="setCanLoadExtJs"><flag>1</flag></action>
        </reference>
    </adminhtml_cms_page_edit>

<!--
    Layout handle for grid ajax loading
-->
    <adminhtml_cms_hierarchy_pagegrid>
        <remove name="root" />
        <block type="Enterprise_Cms_Block_Adminhtml_Cms_Hierarchy_Edit_Form_Grid" name="cms_page_grid" output="toHtml" />
    </adminhtml_cms_hierarchy_pagegrid>

</layout>
