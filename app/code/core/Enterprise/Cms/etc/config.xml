<?xml version="1.0"?>
<!--
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   Enterprise
 * @package    Enterprise_Cms
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://www.magentocommerce.com/license/enterprise-edition
 */
-->
<config>
    <modules>
        <Enterprise_Cms>
             <version>0.1.5</version>
        </Enterprise_Cms>
    </modules>
    <global>
        <models>
            <enterprise_cms>
                <class>Enterprise_Cms_Model</class>
                <resourceModel>enterprise_cms_mysql4</resourceModel>
            </enterprise_cms>
            <enterprise_cms_mysql4>
                <class>Enterprise_Cms_Model_Mysql4</class>
                <entities>
                    <page_version><table>enterprise_cms_page_version</table></page_version>
                    <page_revision><table>enterprise_cms_page_revision</table></page_revision>
                    <increment><table>enterprise_cms_increment</table></increment>
                    <hierarchy>
                        <table>enterprise_cms_hierarchy</table>
                    </hierarchy>
                    <hierarchy_node>
                        <table>enterprise_cms_hierarchy_node</table>
                    </hierarchy_node>
                </entities>
            </enterprise_cms_mysql4>
        </models>
        <blocks>
            <enterprise_cms>
                <class>Enterprise_Cms_Block</class>
            </enterprise_cms>
        </blocks>
        <helpers>
            <enterprise_cms>
                <class>Enterprise_Cms_Helper</class>
            </enterprise_cms>
        </helpers>
        <resources>
            <enterprise_cms_setup>
                <setup>
                    <module>Enterprise_Cms</module>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </enterprise_cms_setup>
            <enterprise_cms_write>
                <connection>
                    <use>core_write</use>
                </connection>
            </enterprise_cms_write>
            <enterprise_cms_read>
                <connection>
                    <use>core_read</use>
                </connection>
            </enterprise_cms_read>
        </resources>
        <events>
            <cms_controller_router_match_before>
                <observers>
                    <enterprise_cms>
                        <type>singleton</type>
                        <class>enterprise_cms/observer</class>
                        <method>cmsControllerRouterMatchBefore</method>
                    </enterprise_cms>
                </observers>
            </cms_controller_router_match_before>
        </events>
    </global>
    <adminhtml>
        <cms>
            <revision_contol>
                <page>
                    <root_template />
                    <meta_keywords />
                    <meta_description />
                    <content />
                    <sort_order />
                    <layout_update_xml />
                    <custom_theme />
                    <custom_theme_from />
                    <custom_theme_to />
                </page>
                <status>
                    <private>
                        <label>Private</label>
                    </private>
                    <protected>
                        <label>Protected</label>
                    </protected>
                    <public>
                        <label>Public</label>
                    </public>
                </status>
            </revision_contol>
            <page>
                <status>
                    <enabled translate="label" module="enterprise_cms">
                        <label>Published</label>
                    </enabled>
                </status>
            </page>
        </cms>
        <layout>
            <updates>
                <enterprise_cms>
                    <file>enterprise/cms.xml</file>
                </enterprise_cms>
            </updates>
        </layout>
        <events>
            <adminhtml_cms_page_edit_tab_main_prepare_form>
                <observers>
                    <enterprise_cms>
                        <type>singleton</type>
                        <class>enterprise_cms/observer</class>
                        <method>onMainTabPrepareForm</method>
                        <type>singleton</type>
                    </enterprise_cms>
                </observers>
            </adminhtml_cms_page_edit_tab_main_prepare_form>
            <cms_page_save_before>
                <observers>
                    <enterprise_cms>
                        <type>singleton</type>
                        <class>enterprise_cms/observer</class>
                        <method>cmsPageSaveBefore</method>
                        <type>singleton</type>
                    </enterprise_cms>
                </observers>
            </cms_page_save_before>
            <cms_page_save_after>
                <observers>
                    <enterprise_cms>
                        <type>singleton</type>
                        <class>enterprise_cms/observer</class>
                        <method>cmsPageSaveAfter</method>
                        <type>singleton</type>
                    </enterprise_cms>
                </observers>
            </cms_page_save_after>
        </events>
        <translate>
            <modules>
                <Enterprise_Cms>
                     <files>
                          <default>Enterprise_Cms.csv</default>
                     </files>
                </Enterprise_Cms>
            </modules>
        </translate>
        <acl>
            <resources>
                <admin>
                    <children>
                        <cms>
                            <children>
                                <page>
                                    <children>
                                        <save_revision translate="title" module="enterprise_cms">
                                            <title>Save Revision</title>
                                            <sort_order>17</sort_order>
                                        </save_revision>
                                        <publish_revision translate="title" module="enterprise_cms">
                                            <title>Publish Revision</title>
                                            <sort_order>20</sort_order>
                                        </publish_revision>
                                        <delete_revision translate="title" module="enterprise_cms">
                                            <title>Delete Revision</title>
                                            <sort_order>25</sort_order>
                                        </delete_revision>
                                    </children>
                                </page>
                                <hierarchy translate="title" module="enterprise_cms">
                                    <title>Manage Hierarchy</title>
                                    <sort_order>0</sort_order>
                                </hierarchy>
                            </children>
                        </cms>
                    </children>
                </admin>
            </resources>
        </acl>
        <menu>
            <cms>
                <children>
                    <hierarchy translate="title" module="enterprise_cms">
                        <title>Manage Pages Hierarchy</title>
                        <sort_order>50</sort_order>
                        <action>adminhtml/cms_hierarchy</action>
                        <depends>
                            <config>enterprise_cms/hierarchy/enabled</config>
                        </depends>
                   </hierarchy>
                </children>
            </cms>
        </menu>
    </adminhtml>

    <admin>
        <routers>
            <adminhtml>
                <args>
                    <modules>
                        <enterprise_cms before="Mage_Adminhtml">Enterprise_Cms_Adminhtml</enterprise_cms>
                    </modules>
                </args>
            </adminhtml>
        </routers>
    </admin>
    <default>
        <cms>
            <hierarchy>
                <enabled>1</enabled>
                <matadata_enabled>1</matadata_enabled>
            </hierarchy>
        </cms>
    </default>
    <crontab>
        <jobs>
            <enterprise_cms_page_revision_expire>
                <schedule><cron_expr>0 2 * * *</cron_expr></schedule>
                <run><model>enterprise_cms/observer::cmsPageRevisionExpireCronJob</model></run>
            </enterprise_cms_page_revision_expire>
        </jobs>
    </crontab>
</config>
