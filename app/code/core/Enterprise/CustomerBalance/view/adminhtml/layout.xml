<?xml version="1.0"?>
<!--
/**
 * {license_notice}
 *
 * @category    design
 * @package     default_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
-->

<layout>
    <adminhtml_customer_edit>
        <reference name="customer_edit_tabs">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance" name="customerbalance"/>
            <action method="addTab"><name>customerbalance</name><block>customerbalance</block></action>
        </reference>
        <reference name="js">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance_Js" template="edit/js.phtml" name="customerbalance_edit_js">
                <action method="setPrefix"><value>_customerbalance</value></action>
            </block>
        </reference>

        <reference name="customer_edit_tab_view">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance_Balance" name="customerbalance.balance" template="balance.phtml" before="-">
                <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance_Balance_Grid" name="customer.balance.grid" as="grid"/>
            </block>
        </reference>
    </adminhtml_customer_edit>


    <adminhtml_customerbalance_form>
        <block type="Mage_Core_Block_Text_List" name="root">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance_Balance" name="customerbalance.balance" template="balance.phtml">
                <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance_Balance_Grid" name="customer.balance.grid" as="grid"/>
            </block>
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance_Form" name="customerbalance.form"/>
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Customer_Edit_Tab_Customerbalance_Balance_History" name="customerbalance.history"/>
        </block>
    </adminhtml_customerbalance_form>

    <adminhtml_sales_order_view>
        <reference name="order_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance" template="Enterprise_CustomerBalance::sales/order/totals/customerbalance.phtml">
                <action method="setSourceField"><value>customer_balance_amount</value></action>
                <action method="setLabel"><value>Store Credit</value></action>
            </block>
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance_refunded" template="sales/order/totals/item.phtml">
                <action method="setSourceField"><value>customer_bal_total_refunded</value></action>
                <action method="setLabel"><value>Refunded to Store Credit</value></action>
                <action method="setDisplayArea"><value>footer</value></action>
                <action method="setStrong"><flag>true</flag></action>
                <action method="setHtmlClass"><class>emph</class></action>
            </block>
        </reference>
    </adminhtml_sales_order_view>

    <adminhtml_sales_order_invoice_new>
        <reference name="invoice_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance" template="Enterprise_CustomerBalance::sales/order/totals/customerbalance.phtml" after="-">
                <action method="setSourceField"><value>customer_balance_amount</value></action>
                <action method="setLabel"><value>Store Credit</value></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_new>

    <adminhtml_sales_order_invoice_updateqty>
        <reference name="invoice_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance" template="Enterprise_CustomerBalance::sales/order/totals/customerbalance.phtml" after="-">
                <action method="setSourceField"><value>customer_balance_amount</value></action>
                <action method="setLabel"><value>Store Credit</value></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_updateqty>

    <adminhtml_sales_order_invoice_view>
        <reference name="invoice_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance" template="Enterprise_CustomerBalance::sales/order/totals/customerbalance.phtml" after="-">
                <action method="setSourceField"><value>customer_balance_amount</value></action>
                <action method="setLabel"><value>Store Credit</value></action>
            </block>
        </reference>
    </adminhtml_sales_order_invoice_view>

    <adminhtml_sales_order_create_load_block_billing_method>
        <reference name="billing_method">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Sales_Order_Create_Payment" template="sales/order/create/payment.phtml" name="customerbalance" before="-" />
        </reference>
    </adminhtml_sales_order_create_load_block_billing_method>

    <adminhtml_sales_order_create_load_block_data>
        <reference name="billing_method">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Sales_Order_Create_Payment" template="sales/order/create/payment.phtml" name="customerbalance" before="-" />
        </reference>
    </adminhtml_sales_order_create_load_block_data>

    <adminhtml_sales_order_create_index>
        <reference name="billing_method">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Sales_Order_Create_Payment" template="sales/order/create/payment.phtml" name="customerbalance" before="-" />
        </reference>
    </adminhtml_sales_order_create_index>

    <adminhtml_sales_order_creditmemo_new>
        <reference name="creditmemo_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance" template="Enterprise_CustomerBalance::sales/creditmemo/totals/customerbalance.phtml" after="-" />
        </reference>
    </adminhtml_sales_order_creditmemo_new>

    <adminhtml_sales_order_creditmemo_updateqty>
        <reference name="creditmemo_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance" template="Enterprise_CustomerBalance::sales/creditmemo/totals/customerbalance.phtml" after="-" />
        </reference>
    </adminhtml_sales_order_creditmemo_updateqty>

    <adminhtml_sales_order_creditmemo_view>
        <reference name="creditmemo_totals">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance" template="Enterprise_CustomerBalance::sales/creditmemo/totals/view.phtml" after="-" />
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance_refunded" template="sales/order/totals/item.phtml">
                <action method="setSourceField"><value>customer_bal_total_refunded</value></action>
                <action method="setAfterCondition"><condition>last</condition></action>
                <action method="setLabel"><value>Refunded to Store Credit</value></action>
                <action method="setDisplayArea"><value>footer</value></action>
                <action method="setStrong"><flag>true</flag></action>
            </block>
        </reference>
        <!--<reference name="footer">
            <block type="Mage_Adminhtml_Block_Sales_Order_Totals_Item" name="customerbalance_refunded" template="sales/order/totals/item.phtml" after="-">
                <action method="setSourceField"><value>customer_bal_total_refunded</value></action>
                <action method="setLabel"><value>Refunded to Store Credit</value></action>
            </block>
        </reference>-->
    </adminhtml_sales_order_creditmemo_view>

    <!-- adminhtml_sales_order_creditmemo_new>
        <reference name="submit_before">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Sales_Order_Creditmemo_Controls" name="customerbalance" template="sales/creditmemo/controls.phtml" />
        </reference>
    </adminhtml_sales_order_creditmemo_new>

    <adminhtml_sales_order_creditmemo_updateqty>
        <reference name="submit_before">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Sales_Order_Creditmemo_Controls" name="customerbalance" template="sales/creditmemo/controls.phtml" />
        </reference>
    </adminhtml_sales_order_creditmemo_updateqty -->

    <adminhtml_sales_order_creditmemo_new>
        <reference name="submit_before">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Sales_Order_Creditmemo_Controls" name="customerbalance" template="sales/creditmemo/refund.phtml" />
        </reference>
    </adminhtml_sales_order_creditmemo_new>

    <adminhtml_sales_order_creditmemo_updateqty>
        <reference name="submit_before">
            <block type="Enterprise_CustomerBalance_Block_Adminhtml_Sales_Order_Creditmemo_Controls" name="customerbalance" template="sales/creditmemo/refund.phtml" />
        </reference>
    </adminhtml_sales_order_creditmemo_updateqty>
</layout>
