<?xml version="1.0"?>
<!--
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   Enterprise
 * @package    Enterprise_Permissions
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
-->
<config>
    <modules>
        <Enterprise_Logging>
             <version>0.1.1</version>
        </Enterprise_Logging>
    </modules>
    <global>
        <models>
          <enterprise_logging_mysql4>
            <class>Enterprise_Logging_Model_Mysql4</class>
            <entities>
              <event>
                <table>enterprise_logging_event</table>
              </event>
            </entities>
          </enterprise_logging_mysql4>
          <enterprise_logging>
                <class>Enterprise_Logging_Model</class>
                <resourceModel>enterprise_logging_mysql4</resourceModel>
          </enterprise_logging>
        </models>
        <blocks>
          <enterprise_logging>
            <class>Enterprise_Logging_Block</class>
          </enterprise_logging>
        </blocks>
        <helpers>
          <enterprise_logging>
            <class>Enterprise_Logging_Helper</class>
          </enterprise_logging>
        </helpers>
        <resources>
            <enterprise_logging_setup>
                <setup>
                    <module>Enterprise_Logging</module>
                    <class>Mage_Eav_Model_Entity_Setup</class>
                </setup>
                <connection>
                    <use>core_setup</use>
                </connection>
            </enterprise_logging_setup>
            <enterprise_logging_write>
              <connection>
                <use>core_write</use>
              </connection>
            </enterprise_logging_write>
            <enterprise_logging_read>
              <connection>
                <use>core_read</use>
              </connection>
            </enterprise_logging_read>
        </resources>
    </global>
    <adminhtml>
        <events>
	    <adminhtml_category_on_save>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCategorySave</method>
                    </enterprise_logging>
                </observers>
	    </adminhtml_category_on_save>

	    <adminhtml_category_on_view>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCategoryView</method>
                    </enterprise_logging>
                </observers>
	    </adminhtml_category_on_view>

	    <adminhtml_category_on_delete>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCategoryDelete</method>
                    </enterprise_logging>
                </observers>
	    </adminhtml_category_on_delete>

        <category_move>
          <observers>
            <enterprise_logging>
              <type>singleton</type>
              <class>enterprise_logging/observer</class>
              <method>addEventOnCategoryMove</method>
            </enterprise_logging>
          </observers>
        </category_move>

        <adminhtml_cmspage_on_view>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCmspageView</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_cmspage_on_view>

        <adminhtml_cmspage_on_save>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCmspageSave</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_cmspage_on_save>

        <adminhtml_cmspage_on_delete>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCmspageDelete</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_cmspage_on_delete>

        <adminhtml_cmsblock_on_view>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCmsblockView</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_cmsblock_on_view>

        <adminhtml_cmsblock_on_save>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCmsblockSave</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_cmsblock_on_save>

        <adminhtml_cmsblock_on_delete>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCmsblockDelete</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_cmsblock_on_delete>

        <adminhtml_customer_on_view>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCustomerView</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_customer_on_view>

        <adminhtml_customer_on_save>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCustomerSave</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_customer_on_save>

        <adminhtml_customer_on_delete>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnCustomerDelete</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_customer_on_delete>

        <adminhtml_report_on_view>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnReportView</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_report_on_view>

        <adminhtml_system_config_on_view>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnSystemConfigView</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_system_config_on_view>

        <adminhtml_system_config_on_save>
                <observers>
                    <enterprise_logging>
                        <type>singleton</type>
                        <class>enterprise_logging/observer</class>
                        <method>addEventOnSystemConfigSave</method>
                    </enterprise_logging>
                </observers>
        </adminhtml_system_config_on_save>


        <adminhtml_product_on_view>
          <observers>
            <enterprise_logging>
              <type>singleton</type>
              <class>enterprise_logging/observer</class>
              <method>addEventAfterProductView</method>
            </enterprise_logging>
          </observers>
        </adminhtml_product_on_view>
        
        <admin_user_on_login>
          <observers>
            <enterprise_logging>
              <type>singleton</type>
              <class>enterprise_logging/observer</class>
              <method>addEventAfterLogin</method>
            </enterprise_logging>
          </observers>
        </admin_user_on_login>

        <adminhtml_on_forgotpassword>
          <observers>
            <enterprise_logging>
              <type>singleton</type>
              <class>enterprise_logging/observer</class>
              <method>addEventOnForgotpassword</method>
            </enterprise_logging>
          </observers>
        </adminhtml_on_forgotpassword>

        <adminhtml_product_on_save>
          <observers>
            <enterprise_logging>
              <type>singleton</type>
              <class>enterprise_logging/observer</class>
              <method>addEventOnProductSave</method>
            </enterprise_logging>
          </observers>
        </adminhtml_product_on_save>

        <adminhtml_product_on_delete>
          <observers>
            <enterprise_logging>
              <type>singleton</type>
              <class>enterprise_logging/observer</class>
              <method>addEventOnProductDelete</method>
            </enterprise_logging>
          </observers>
        </adminhtml_product_on_delete>
        </events>
        <menu>
          <report>
            <children>
              <logging translate="title">
                 <title>Admin Logging</title>
                 <sort_order>71</sort_order>
                 <action>adminhtml/events</action>
                 <depends><module>Enterprise_Logging</module></depends>
                 <children>
                   <backups translate="title">
                     <title>Saved files</title>
                     <sort_order>1</sort_order>
                     <action>adminhtml/events/log</action>
                     <depends><module>Enterprise_Logging</module></depends>
                   </backups>
                 </children>
              </logging>
            </children>
          </report>
        </menu>
        <acl>
          <resources>
            <admin>
              <children>
                <system>
                  <children>
                    <config>
                      <children>
                        <logging>
                          <title>Logging</title>
                        </logging>
                      </children>
                    </config>
                  </children>
                </system>
              </children>
            </admin>
          </resources>
        </acl>
        <acl>
          <resources>
            <admin>
              <children>
                <report>
                  <children>
                        <logging translate="title" module="enterprise_logging">
                          <title>Admin Logging</title>
                          <children>
                            <backups translate="title" module="enterprise_logging">
                              <title>Saved files</title>
                            </backups>
                          </children>
                        </logging>
                  </children>
                </report>
              </children>
            </admin>
          </resources>
        </acl>



        <layout>
            <updates>
                <events>
                    <file>enterprise/events.xml</file>
                </events>
            </updates>
        </layout>
        <enterprise>
          <logging>
            <events>
              <products module="enterprise_logging" translate="Label">
                <label>Products</label>
                <code>10</code>
                <actions>
                  <view>
                    <success>Product (sku=%s) viewed successfully</success>
                  </view>
                  <delete>
                    <success>Product (sku=%s) deleted successfully</success>
                    <fail>Product (sku=%s) was failed to delete</fail>
                  </delete>
                  <save>
                    <success>Product (sku=%s) saved successfully</success>
                    <fail>Product (sku=%s) was failed to save</fail>
                  </save>
                </actions>
              </products>

              <categories module="enterprise_logging" translate="Label">
                <label>Categories</label>
                <code>20</code>
                <actions>
                  <view>
                    <success>"Category (%s) viewed successfully"</success>
                  </view>
                  <delete>
                    <success>"Category (%s) deleted successfully"</success>
                    <fail>"Category (%s) was failed to delete"</fail>
                  </delete>
                  <save>
                    <success>"Category (%s) saved successfully"</success>
                    <fail>"Category (%s) was failed to save"</fail>
                  </save>
                  <move>
                    <success>"Category (%s) moved successfully from %s to %s"</success>
                    <fail>"Category (%s) was failed to move from %s to %s"</fail>
                  </move>
                </actions>
              </categories>

              <customers module="enterprise_logging" translate="Label">
                <label>Customers</label>
                <code>30</code>
                <actions>
                  <view>
                    <success>Customer (id=%s, name=%s) viewed successfully</success>
                  </view>
                  <delete>
                    <success>Customer (id=%s, name=%s) deleted successfully</success>
                    <fail>Customer (id=%s, name=%s) was fail to delete</fail>
                  </delete>
                  <save>
                    <success>Customer (id=%s, name=%s) saved successfully</success>
                    <fail>Customer (id=%s, name=%s) was failed to save</fail>
                  </save>
                </actions>
              </customers>

              <cmspages module="enterprise_logging" translate="Label">
                <label>Cms Pages</label>
                <code>40</code>
                <actions>
                  <view>
                    <success>Cms page %s viewed successfully</success>
                  </view>
                  <delete>
                    <success>Cms page %s deleted successfully</success>
                    <fail>Cms page %s was fail to delete</fail>
                  </delete>
                  <save>
                    <success>Cms page %s saved successfully</success>
                    <fail>Cms page %s was failed to save</fail>
                  </save>
                </actions>
              </cmspages>

              <cmsblocks module="enterprise_logging" translate="Label">
                <label>Cms Blocks</label>
                <code>50</code>
                <actions>
                  <view>
                    <success>Cms block %s viewed successfully</success>
                  </view>
                  <delete>
                    <success>Cms block %s deleted successfully</success>
                    <fail>Cms block %s was fail to delete</fail>
                  </delete>
                  <save>
                    <success>Cms block %s saved successfully</success>
                    <fail>Cms block %s was failed to save</fail>
                  </save>
                </actions>
              </cmsblocks>

              <adminlogin module="enterprise_logging" translate="Label">
                <label>Admin Login</label>
                <code>60</code>
                <actions>
	              <login>
		            <success>User %s successfully logged in</success>
	              </login>
                  <forgotpassword>
                    <success>Password remind asked for email: %s</success>
                  </forgotpassword>
                </actions>
              </adminlogin>

              <systemconfiguration module="enterprise_logging" translate="Label">
                <label>System Configuration</label>
                <code>70</code>
                <actions>
                  <view>
                    <success>Section %s of system configuration, was viewed</success>
                  </view>
                  <save>
                    <success>Section %s of system configuration, was successfully updated</success>
                    <fail>Section %s of system configuration, was failed to update</fail>
                  </save>
                </actions>
              </systemconfiguration>

              <reports module="enterprise_logging" translate="Label">
                <label>Reports</label>
                <code>80</code>
                <actions>
                  <view>
                    <success>Report %s viewed</success>
                  </view>
                </actions>
              </reports>

            </events>
            <frequency>
              <daily>
                <label>Daily</label>
                <value>1</value>
              </daily>
              <weekly>
                <label>Weekly</label>
                <value>7</value>
              </weekly>
              <monthly>
                <label>Monthly</label>
                <value>30</value>
              </monthly>
            </frequency>
            <lifetime>
              <oneday>
                <label>One Day</label>
                <value>1</value>
              </oneday>
              <week>
                <label>One Week</label>
                <value>7</value>
              </week>
              <month>
                <label>30 days</label>
                <value>30</value>
              </month>
              <twomonth>
                <label>60 days</label>
                <value>60</value>
              </twomonth>
              <quartal>
                <label>90 days</label>
                <value>90</value>
              </quartal>
            </lifetime>
          </logging>
        </enterprise>

    </adminhtml>

    <admin>
        <routers>
            <adminhtml>
                <args>
                    <frontName>admin</frontName>
                    <modules>
                        <Enterprise_Logging before="Mage_Adminhtml">Enterprise_Logging_Adminhtml</Enterprise_Logging>
                    </modules>
                </args>
            </adminhtml>
        </routers>
        <acl>
          <resources>
            <admin>
                <system>
                    <config>
                        <logging />
                    </config>
                </system>
            </admin>
          </resources>
        </acl>

    </admin>

    <default>
      <logging>
        <enabled>
          <products>1</products>
          <categories>0</categories>
          <adminlogin>1</adminlogin>
        </enabled>
        <rotation>
          <frequency>monthly</frequency>
          <lifetime>60</lifetime>
        </rotation>
      </logging>
    </default>

    <crontab>
        <jobs>
            <enterprise_logging_rotate_logs>
                <schedule><cron_expr>10 2 * * *</cron_expr></schedule>
                <run><model>enterprise_logging/observer::rotateLogs</model></run>
            </enterprise_logging_rotate_logs>
        </jobs>
    </crontab>

</config>
