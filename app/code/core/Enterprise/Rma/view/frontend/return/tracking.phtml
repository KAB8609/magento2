<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
/** @var $this Enterprise_Rma_Block_Return_Tracking */
?>

<?php if ($this->getErrorMessage()): ?>
<tr>
    <td colspan="3">
        <ul class="messages">
             <li class="error-msg"><?php echo $this->escapeHtml($this->getErrorMessage()) ?></li>
        </ul>
    </td>
</tr>
<?php endif ?>
<?php foreach ($this->getTrackingNumbers() as $number): ?>
<tr>
    <td><?php echo $this->escapeHtml($number->getCarrierTitle()) ?></td>
    <td>
        <a
            href="#"
            data-mage-popwin = "{windowURL:'<?php echo $this->helper('Enterprise_Rma_Helper_Data')->getTrackingPopupUrlBySalesModel($number) ?>',windowName:'trackshipment',width:800,height:600,top:0,left:0,resizable:1,scrollbars:1}"
            title="<?php echo $this->escapeHtml($number->getTrackNumber()) ?>">
                <?php echo $this->escapeHtml($number->getTrackNumber()) ?>
        </a>
    </td>
    <td>
        <?php if(!$number->getIsAdmin() && $this->isPrintShippingLabelAllowed()): ?>
            <a href="#" data-entity-id="<?php echo $number->getEntityId()?>">
                <?php echo $this->__('Delete') ?>
            </a>
        <?php endif; ?>
    </td>
</tr>
<?php endforeach; ?>
<?php if ($this->isPrintShippingLabelAllowed()): ?>
<script type="text/javascript">
    (function($) {
        $('#rma_track_info').on('mage.setUpRmaOptions', function(e, rmaTrackInfo) {
            rmaTrackInfo.options.deleteLabelUrl = '<?php echo $this->getDeleteLabelUrl() ?>';
            rmaTrackInfo.options.deleteMsg = '<?php echo $this->__('Are you sure you want to delete this tracking information?') ?>';
        });
        //Need to invoke popwin specifically since this script is injected every time with ajax
        //For effeciency just limiting to associated anchors
        head.js("<?php echo $this->getViewFileUrl('jquery/jquery.popupwindow.js')?>", function() {
            $('#rma_track_info').find('a[data-mage-popwin]').each(function() {
                $(this).popupWindow(eval("(" + $(this).attr('data-mage-popwin') + ")"));
            });
        });
    })(jQuery);
</script>
<?php endif; ?>
