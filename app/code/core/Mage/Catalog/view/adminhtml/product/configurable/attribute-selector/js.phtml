<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     default_default
 * @copyright   {copyright}
 * @license     {license_link}
 */

/** @var $this Mage_Catalog_Block_Product_Configurable_AttributeSelector */
?>
<script type="text/javascript">
(function($) {
    'use strict';
    $(function() {
        var self = $('#attribute-selector')
            .bind('ajaxSend ajaxComplete', function(e) {
                e.stopPropagation();
            })
            .autocomplete({
                minLength: 0,
                appendTo: '#config_super_product',
                source: function(request, response) {
                    $.ajax({
                        url: '<?php echo $this->getSuggestUrl()?>',
                        data: {label_part: request.term},
                        dataType: 'json',
                        context: self
                    })
                    .success(function(data) {
                        var list = [];
                        $.each(data, function(id, item) {
                            if (!$('#attribute_' + id + '.configurable-attribute-checkbox').length) {
                                list.push({
                                    label: item.label,
                                    value: id
                                });
                            }
                        });
                        response(list);
                    });
                },
                focus: function(event, ui) {
                    return false;
                },
                select: function(event, ui) {
                    var rowTemplate =
                        '<tr id="attribute-attribute_${id}-container">' +
                            '<td class="label">' +
                                '<label for="attribute_${id}">${label}</label>' +
                            '</td>' +
                            '<td class="value">' +
                                '<input id="attribute_${id}" name="attributes[]" value="${id}" title="${label}" ' +
                                    'class="configurable-attribute-checkbox" checked="checked" type="checkbox">' +
                            '</td>' +
                            '<td class="scope-label">' +
                                '<span class="nobr"></span>' +
                            '</td>' +
                        '</tr>';

                    $('tr:has(#continue_button)').before($.tmpl(rowTemplate, {
                        id: ui.item.value,
                        label: ui.item.label
                    }));
                    $(this).val('');

                    return false;
                }
            })
            .focus(function () {
                $(this).autocomplete('search');
            });
    });
})(jQuery);
</script>
