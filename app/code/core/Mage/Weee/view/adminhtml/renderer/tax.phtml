<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     default_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php $itemsData = $this->getValues(); ?>
<?php foreach ($itemsData as &$_item): ?>
<?php $_item['prefix'] = $this->getElement()->getHtmlId(); ?>
<?php endforeach; ?>
<?php $itemsData = Mage::helper('Mage_Core_Helper_Data')->jsonEncode($itemsData) ?>
<div id="attribute-<?php echo $this->getElement()->getHtmlId(); ?>-container" class="field"
     data-mage-init="{weeeTaxes:{
        region: <?php echo $this->escapeHtml($this->helper('Mage_Directory_Helper_Data')->getRegionJson()) ?>,
        prefix: '<?php echo $this->escapeHtml($this->getElement()->getHtmlId()); ?>',
        itemCount: 1, itemsData: <?php echo $this->escapeHtml($itemsData); ?>}}">
    <label class="label"><span><?php echo $this->getElement()->getLabel() ?></span></label>

    <div class="control">
        <table id="<?php echo $this->getElement()->getHtmlId(); ?>_table" class="data-table" cellspacing="0">
            <thead>
            <tr class="headings">
                <th <?php if (!$this->isMultiWebsites()): ?>style="display:none"<?php endif; ?>><?php echo Mage::helper('Mage_Sales_Helper_Data')->__('Website') ?></th>
                <th><?php echo Mage::helper('Mage_Catalog_Helper_Data')->__('Country/State') ?><span class="required">*</span></th>
                <th><?php echo Mage::helper('Mage_Catalog_Helper_Data')->__('Tax') ?><span class="required">*</span></th>
                <th><?php echo Mage::helper('Mage_Catalog_Helper_Data')->__('Action') ?></th>
            </tr>
            </thead>
            <tbody id="<?php echo $this->getElement()->getHtmlId() ?>_container">
            </tbody>
            <tfoot>
            <tr>
                <td colspan="4"><?php echo $this->getAddButtonHtml() ?></td>
            </tr>
            </tfoot>
        </table>
    </div>
    <script id="wee-tax-row-template" type="text/x-jquery-tmpl">
        <tr id="<?php echo $this->getElement()->getHtmlId() ?>_weee_tax_row_${index}">
            <td <?php if (!$this->isMultiWebsites()): ?>style="display: none"<?php endif; ?>>
                <select class="<?php echo $this->getElement()->getClass() ?> required-entry"
                        name="<?php echo $this->getElement()->getName() ?>[${index}][website_id]"
                        id="${prefix}_weee_tax_row_${index}_website">
                    <?php foreach ($this->getWebsites() as $_websiteId => $_info): ?>
                    <option value="<?php echo $_websiteId ?>"><?php echo $_info['name'] ?><?php if (!empty($_info['currency'])): ?>[<?php echo $_info['currency'] ?>]<?php endif; ?></option>
                    <?php endforeach ?>
                </select>
            </td>
            <td>
                <select id="${prefix}_weee_tax_row_${index}_country"
                        name="<?php echo $this->getElement()->getName() ?>[${index}][country]"
                        class="<?php echo $this->getElement()->getClass() ?> country required-entry">
                    <?php foreach ($this->getCountries() as $_country): ?>
                    <option value="<?php echo $_country['value'] ?>"><?php echo htmlspecialchars($_country['label']) ?></option>
                    <?php endforeach ?>
                </select>
                <select id="${prefix}_weee_tax_row_${index}_state"
                        name="<?php echo $this->getElement()->getName() ?>[${index}][state]"
                        class="<?php echo $this->getElement()->getClass() ?> state" disabled="">
                    <option value="0">*</option>
                </select>
            </td>
            <td>
                <input class="<?php echo $this->getElement()->getClass() ?> required-entry validate-greater-than-zero"
                       type="text" name="<?php echo $this->getElement()->getName() ?>[${index}][price]"
                       value="${value}"/>
            </td>
            <td>
                <input id="${prefix}_weee_tax_row_${index}_delete"
                       name="<?php echo $this->getElement()->getName() ?>[${index}][delete]" type="hidden"
                       class="delete" value=""/>
                <?php echo $this->getChildHtml('delete_button') ?>
            </td>
        </tr>
    </script>
</div>