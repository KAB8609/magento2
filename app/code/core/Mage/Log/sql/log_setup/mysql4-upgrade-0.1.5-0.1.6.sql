SET NAMES utf8;

SET SQL_MODE='';

SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO';

ALTER TABLE `log_quote` CHANGE `deleted_at` `deleted_at` DATETIME NULL DEFAULT NULL;

ALTER TABLE `log_visitor` DROP `server_addr` ,
DROP `remote_addr` ;

DELETE FROM log_visitor_info;
ALTER TABLE log_visitor_info
  ADD CONSTRAINT FK_VISITOR_PARENT FOREIGN KEY (visitor_id) REFERENCES log_visitor (visitor_id) ON DELETE CASCADE ON UPDATE CASCADE;

DELETE FROM log_customer;
ALTER TABLE log_customer
  ADD CONSTRAINT FK_CUSTOMER_PARENT FOREIGN KEY (visitor_id) REFERENCES log_visitor (visitor_id) ON DELETE CASCADE ON UPDATE CASCADE;

DELETE FROM log_quote;
ALTER TABLE log_quote
  ADD CONSTRAINT FK_QUOTE_PARENT FOREIGN KEY (visitor_id) REFERENCES log_visitor (visitor_id) ON DELETE CASCADE ON UPDATE CASCADE;

DELETE FROM log_url;
ALTER TABLE log_url
  ADD CONSTRAINT FK_URL_PARENT FOREIGN KEY (visitor_id) REFERENCES log_visitor (visitor_id) ON DELETE CASCADE ON UPDATE CASCADE;

DELETE FROM log_url_info;
ALTER TABLE log_url_info
  ADD CONSTRAINT FK_URL_INFO_PARENT FOREIGN KEY (url_id) REFERENCES log_url (url_id) ON DELETE CASCADE ON UPDATE CASCADE;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
