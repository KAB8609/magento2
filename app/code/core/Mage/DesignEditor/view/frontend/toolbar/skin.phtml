<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     Mage_DesignEditor
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php /** @var $this Mage_DesignEditor_Block_Toolbar_Skin */ ?>
<div class="skin-selector">
    <?php echo Mage::helper('Mage_DesignEditor_Helper_Data')->__('Skin:'); ?>
    <select id="<?php echo $this->getSelectHtmlId(); ?>">
        <?php foreach ($this->getOptions() as $optGroup): ?>
            <optgroup label="<?php echo $this->escapeHtml($optGroup['label']) ?>">
                <?php foreach ($optGroup['value'] as $option): ?>
                    <?php $selected = $this->isSkinSelected($option['value']) ? 'selected' : ''; ?>
                    <option value="<?php echo $this->escapeHtml($option['value']); ?>" <?php echo $selected; ?>>
                        <?php echo $this->escapeHtml($option['label']); ?>
                    </option>
                <?php endforeach; ?>
            </optgroup>
        <?php endforeach; ?>
    </select>
</div>

<script>
(function ($) {
    var DesignEditorSkinSelector = function (config) {
        this._init(config);
        this._addListener();
        return this;
    }

    DesignEditorSkinSelector.prototype._init = function (config) {
        this._skinControlSelector = '#' + config.selectId;
        this._backParams = config.backParams;
        this.changeSkinUrl = config.changeSkinUrl;
        return this;
    }

    DesignEditorSkinSelector.prototype._addListener = function () {
        var thisObj = this;
        $(this._skinControlSelector).change(
            function () {thisObj.changeSkin()}
        );
        return this;
    }

    DesignEditorSkinSelector.prototype.changeSkin = function () {
        var separator = /\?/.test(this.changeSkinUrl) ? '&' : '?';

        var params = {skin: $(this._skinControlSelector).val()};
        for (var i in this._backParams) {
            params[i] = this._backParams[i];
        }

        var url = this.changeSkinUrl + separator + $.param(params);

        window.location.href = url;
        return this;
    }

    $(document).ready(function () {
        new DesignEditorSkinSelector(<?php echo $this->getJsonConfig() ?>);
    });
})(jQuery);
</script>
