<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     base_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
/**
 * @var $this Mage_Paypal_Block_Iframe
 */
?>
<html>
<head>
<script type="text/javascript">
//<![CDATA[
    function allowCheckoutSteps(allow)
    {
        var window_top = window.top;
        for (var s = 0; s < window_top.checkout.steps.length; s++) {
            if (window_top.checkout.steps[s] == '<?php echo $this->getGotoSection() ?>') {
                break;
            }
            if (window_top.document.getElementById('opc-' + window_top.checkout.steps[s])) {
                if (allow) {
                    window_top.document.getElementById('opc-' + window_top.checkout.steps[s]).addClassName('allow');
                } else {
                    window_top.document.getElementById('opc-' + window_top.checkout.steps[s]).removeClassName('allow');
                }
            }
        }
    }
if (window.top==window.self) {
    window.location = "<?php echo $this->getUrl('checkout/cart') ?>";
}
var window_name = '<?php echo Mage::getBaseUrl(); ?>';
var window_top = window.top;
var allowed_domain = false;
try{
    allowed_domain = window_name == window_top.name
}catch(e){
    allowed_domain = false;
}
<?php if ($this->getErrorMsg()): ?>
    alert('<?php echo $this->getErrorMsg() ?>');
    if (allowed_domain) {
        window_top.payflowLink.showLoading();
    }
    window.location = "<?php echo $this->getUrl('paypal/payflow/form') ?>";
<?php else: ?>
    if (allowed_domain) {
        <?php if ($this->getGotoSection()): ?>
            allowCheckoutSteps(true);
            <?php if ($this->getGotoSection() == 'review'): ?>
                allowCheckoutSteps(false);
                window_top.payment.save();
            <?php else : ?>
                window_top.checkout.gotoSection("<?php echo $this->getGotoSection() ?>");
            <?php endif; ?>
        <?php else : ?>
            window_top.location="<?php echo $this->getUrl('checkout/cart') ?>";
        <?php endif; ?>
    } else {
        alert('<?php echo $this->jsQuoteEscape($this->__('Wrong configuration of Payment Method')) ;?>');
    }
<?php endif; ?>
//]]>
</script>
</head>
<body></body>
</html>
