<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     default_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>

<div id="answers_container" class="fieldset-wrapper">
    <?php if( $answers ): ?>
        <div class="fieldset-wrapper-title">
            <span class="title"><?php echo Mage::helper('Mage_Poll_Helper_Data')->__('Assigned Answers') ?></span>
        </div>

        <?php foreach($answers->getItems() as $_item): ?>
            <fieldset class="fieldset" id="poll_answer_fieldset_<?php echo $_item->getId() ?>">

                <div class="field required">
                    <label class="label" for="answer_<?php echo $_item->getId() ?>"><?php echo Mage::helper('Mage_Poll_Helper_Data')->__('Answer Title:') ?></label>

                    <div class="control">
                        <input type="text" id="answer_<?php echo $_item->getId() ?>" name="answer[<?php echo $_item->getId() ?>][title]" value="<?php echo $this->escapeHtml($_item->getAnswerTitle()) ?>" class="required-entry" />
                    </div>
                </div>

                <div class="field required">
                    <label class="label" for="answer_votes_<?php echo $_item->getId() ?>"><?php echo Mage::helper('Mage_Poll_Helper_Data')->__('Votes Count:') ?></label>

                    <div class="control">
                        <input type="text" id="answer_votes_<?php echo $_item->getId() ?>" name="answer[<?php echo $_item->getId() ?>][votes]" value="<?php echo $_item->getVotesCount() ?>" class="required-entry validate-not-negative-number" />
                    </div>
                </div>

                <?php echo $this->getDeleteButtonHtml() ?>

                <input type="hidden" id="id_poll_answer_fieldset_<?php echo $_item->getId() ?>" value="<?php echo $_item->getId() ?>" />

            </fieldset>
        <?php endforeach; ?>

    <?php endif; ?>
</div>

<?php echo $this->getAddButtonHtml(); ?>




<script type="text/template" id="templatePollAnswer">
    <fieldset class="fieldset" id="poll_answer_fieldset_#{id}">
        <div class="field required">
            <label class="label" for="answer_#{id}"><?php echo Mage::helper('Mage_Poll_Helper_Data')->__('Answer Title:') ?></label>

            <div class="control">
                <input type="text" id="answer_#{id}" name="answer[#{id}][title]" value="" class="required-entry" />
            </div>
        </div>

        <div class="field required">
            <label class="label" for="answer_votes_#{id}"><?php echo Mage::helper('Mage_Poll_Helper_Data')->__('Votes Count:') ?></label>

            <div class="control">
            <input type="text" id="answer_votes_#{id}" name="answer[#{id}][votes]" value="0" class="required-entry validate-not-negative-number" />
            </div>
        </div>

        <?php echo $this->getDeleteButtonHtml() ?>

        <input type="hidden" id="id_poll_answer_fieldset_#{id}" value="#{id}" />
    </fieldset>
</script>




<script type="text/template" id="templatePollHidden">
    <input type="hidden" name="deleteAnswer[]" value="#{id}" />
</script>




<script type="text/javascript">
(function($) {
    'use strict';

    $.widget('mage.xxx', {
        options: {
        },
        
        lastId: 0,
    
        _init: function() {
            this.templatePollAnswer = new Template($('#templatePollAnswer').html());
            this.templatePollHidden = new Template($('#templatePollHidden').html());
            this.container = $('#answers_container');
        },
    
        _create: function() {
            this._bind();
        },

        _bind: function() {
            var self = this;

            $('body')
                .on('click.btnPollAddAnswer', '.action-add', function() {
                    self.addAnswer();
                })
                .on('click.btnPollDeleteAnswer', '.action-delete', function() {
                    self.deleteAnswer(this);
                });
        },

        addAnswer: function() {
            this.container.append(this.templatePollAnswer.evaluate({
                id: --this.lastId
            }));
        },

        deleteAnswer: function(el) {
            if(confirm('<?php echo Mage::helper('Mage_Poll_Helper_Data')->__('Are you sure you want to delete it?') ?>')) {
                var fieldset = $(el).closest('.fieldset');
                var id = $('#id_' + fieldset.attr("id")).attr("value");
                this.container.append(this.templatePollHidden.evaluate({
                    id: id
                }));
                fieldset.remove();
            }
        }
    });

    $('#poll_tabs_answers_section_content').xxx();
})(jQuery);
</script>
