<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     default_default
 * @copyright   {copyright}
 * @license     {license_link}
 */

/**
 * Order by SKU Failed Items renderer
 */

/** @var $this Magento_Checkout_Block_Cart_Item_Renderer */
$_item = $this->getItem();
$displayBothPrices = $this->helper('Magento_Tax_Helper_Data')->displayCartBothPrices();
$additionalInfoBlock = $this->getProductAdditionalInformationBlock();

$maxQuantity = -1;
if ($_item->getQtyMaxAllowed()) {
    $maxQuantity = $_item->getQtyMaxAllowed();
}

// disable the qty field if there is no product associated with the sku (i.e. invalid sku) or if sku failed for
// out of stock scenario
$qtyDisabled = !$this->hasProductUrl() ||
        $_item->getCode() == Magento_AdvancedCheckout_Helper_Data::ADD_ITEM_STATUS_FAILED_OUT_OF_STOCK;
?>
<tr data-mage-init='{orderBySkuFailure:{}}'>
    <td>
        <img src="<?php echo $this->getProductThumbnailUrl() ?>" width="<?php echo $this->getThumbnailSize() ?>" height="<?php echo $this->getThumbnailSize() ?>" alt="<?php echo $this->escapeHtml($this->getProductName()) ?>" />
    </td>
    <td>
        <h3 class="product-name"><?php echo $this->escapeHtml($this->getProductName()) ?></h3>
        <?php if ($additionalInfoBlock):?>
            <?php echo $additionalInfoBlock->setItem($_item)->toHtml() ?>
        <?php endif;?>
    </td>
    <td class="a-center"></td>
    <?php if ($this->helper('Magento_Wishlist_Helper_Data')->isAllowInCart()) : ?><td class="a-center"></td><?php endif ?>
    <td class="a-right"<?php if ($displayBothPrices): ?> colspan="2"<?php endif; ?>></td>
    <td class="a-center">
        <?php $validateItemQuantityCheck = false; ?>
        <input name="cart[<?php echo $this->escapeHtml($_item->getSku()) ?>][qty]" value="<?php echo $this->getQty() ?>"
                size="4" class="input-text qty <?php if ($qtyDisabled): ?>disabled<?php endif ?>" maxlength="12"
                title="<?php echo __('Qty') ?>" data-role="input-qty"
                <?php if ($qtyDisabled): ?>disabled="disabled"<?php endif ?>
                data-validate="{'required': true,'validate-greater-than-zero': true, 'validate-item-quantity': {
                <?php if ($_item->getQtyMinAllowed()): ?>'minAllowed': <?php echo $_item->getQtyMinAllowed(); $validateItemQuantityCheck = true; ?><?php endif ?>
                <?php if ($maxQuantity > 0): ?><?php if ($validateItemQuantityCheck): ?>,<?php endif ?> 'maxAllowed': <?php echo $maxQuantity; $validateItemQuantityCheck = true; ?><?php endif ?>
                <?php if ($_item->getQtyIncrements() > 0): ?>
                    <?php if ($validateItemQuantityCheck): ?>,<?php endif ?> 'qtyIncrements': <?php echo $_item->getQtyIncrements() ?>
                <?php endif ?>}}" />
    </td>
    <td class="a-center last"><a href="<?php echo $this->getDeleteUrl()?>" title="<?php echo __('Remove item')?>" class="btn-remove btn-remove2"><?php echo __('Remove item')?></a></td>
</tr>
