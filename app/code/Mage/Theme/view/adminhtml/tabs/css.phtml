<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     Mage_Theme
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>

<?php /** @var $this Mage_Theme_Block_Adminhtml_System_Design_Theme_Edit_Tab_Css */ ?>

<?php echo $this->getFormHtml(); ?>

<script type="text/javascript">
    (function ($) {

        $( '#css_file_uploader' ).fileupload({
            dataType: 'json',
            replaceFileInput: false,
            url : '<?php echo $this->getUrl('*/system_design_theme/uploadcss') ?>',
            acceptFileTypes: /(.|\/)(css)$/i,

            /**
             * Add data
             * @param e
             * @param data
             */
            add: function (e, data) {
                var uploadButton = $('#css_uploader_button');
                /** Unbind click event on file change */
                uploadButton.unbind('click');
                uploadButton.removeAttr('disabled');

                uploadButton.click(function () {
                    $('#messages').html('');
                    $(this).attr('disabled', 'disabled');
                    data.submit();
                });
            },

            /**
             * On done event
             * @param e
             * @param data
             */
            done: function (e, data) {
                var contentArea = $('#custom_css_content');
                $(this).val('');

                $('#css_uploader_button').attr('disabled', 'disabled');

                if (!data.result.error) {
                    contentArea.trigger('focusin');
                    contentArea.val(data.result.content);
                    contentArea.trigger('focusout');
                }
            },

            /**
             * Fail event
             * @param e
             * @param data
             */
            fail: function(e, data) {
                $(this).val('');
                alert($.mage.__('File extension not known or unsupported type.'));
            }
        });

        $(document).on('beforeSubmit', function() {
            $('#css_file_uploader').val('');
        });

    })(jQuery);
</script>
