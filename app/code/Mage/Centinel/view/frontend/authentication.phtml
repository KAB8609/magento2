<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     base_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php if ($this->getAuthenticationStart()):?>
    <div class="centinel" id="centinel-authenticate-block">
        <h3><?php echo $this->__('Card Verification')?></h3>
        <p><?php echo $this->__('Please verify the card with the issuer bank:') ?></p>
        <div class="authentication">
            <iframe id="centinel-authenticate-iframe" frameborder="0" border="0" src=""></iframe>
        </div>
    </div>
    <script type="text/javascript">
        (function ($) {
            head.js(
                    "<?php echo $this->getViewFileUrl('Mage_Centinel::centinel-authenticate.js') ?>",
                    function () {
                        var centinelAuthenticate = $('#centinel-authenticate-block').centinelAuthenticate({
                            relatedBlockSelectors: [
                                <?php foreach ($this->getRelatedBlocks() as $relatedBlockId): ?>
                                    '#<?php echo $relatedBlockId ?>',
                                <?php endforeach;?>
                            ],
                            frameUrl: '<?php echo $this->getFrameUrl() ?>',
                            blockSelector: '#centinel-authenticate-block',
                            iframeSelector: '#centinel-authenticate-iframe'
                        });
                        // start the authentication control based on how it is being displeyed
                        <?php if ($this->getAuthenticationStartMode() == 'instant'): ?>
                            jQuery('#centinel-authenticate-block').centinelAuthenticate('start');
                        <?php elseif ($this->getAuthenticationStartMode() == 'window'):?>
                            $(document).ready(function () {
                                jQuery('#centinel-authenticate-block').centinelAuthenticate('start');
                            });
                        <?php endif;?>
                    });
        })(jQuery);
    </script>
<?php else:?>
    <script type="text/javascript">
        jQuery('#centinel-authenticate-block').centinelAuthenticate('cancel');
    </script>
<?php endif;?>
