<?/*{

}*/?>
<?if (empty($_level)):?>
<!-- menu start -->
<script type="text/javascript">
var isIE = window.navigator.userAgent.indexOf("MSIE") > 0;

function toggleMenu(el, over) {
    if (isIE && !over) {
        uls = el.getElementsByTagName('ul');
        if (uls.length>0) toggleIntersectingSelects(uls[0], over);
    }
	if (over) {
	    Element.addClassName(el, 'over');
	} else {
	    Element.removeClassName(el, 'over');
	}
	if (isIE && over) {
	   uls = el.getElementsByTagName('ul');
	   if (uls.length>0) toggleIntersectingSelects(uls[0], over);
	}
}

function getElementInfo(el) {
	var l = 0, t = 0, o = el;
	if (o.offsetParent) { 
		l = o.offsetLeft; t = o.offsetTop;
		while (o = o.offsetParent) { l += o.offsetLeft; t += o.offsetTop }
	}
	return {x1:l, y1:t, x2:l+el.offsetWidth, y2:t+el.offsetHeight};
}

function toggleIntersectingSelects(el, hide) {
    var e1 = getElementInfo(el);    
    var selects = document.getElementsByTagName('select');
    for (var i=0, l=selects.length; i<l; i++) {
        var e2 = getElementInfo(selects[i]);
        var intersect = !(
            (e1.x1 <= e2.x1 && e1.x2 < e2.x1) || (e1.x1 > e2.x1 && e2.x2 < e1.x1) || 
            (e1.y2 >= e2.y2 && e1.y1 > e2.y2) || (e1.y2 < e2.y2 && e2.y1 > e1.y2)
        );       
        if (intersect) selects[i].style.visibility = hide ? "hidden" : "visible";
    };
}
</script>
<ul class="h">
<?  $_level = 0; ?>
<?endif?>

<?foreach ($menu as $_item):?>
    <li <?if(!empty($_item['children'])):?>onmouseover="toggleMenu(this,1)" onmouseout="toggleMenu(this,0)"<?endif?> class="<?=!empty($_item['active'])?'active':''?>">
       <a href="<?=$_item['url']?>" title="<?=$_item['title']?>" <?if(!empty($_item['click'])):?> onclick="<?=$_item['click'];?>"<?endif?> class="<?=!empty($_item['active'])?'active':''?> <?=!empty($_item['children'])?'parent':''?> level<?=$_level?>">
            <?=$_item['label']?>
            <?if(empty($_level)):?><em></em><?endif?>
       </a>
       <?if(!empty($_item['children'])):?>
        <ul>
        <?
            $_menuData[$_level] = array('menu'=>$menu);
            $menu = $_item['children'];
            $_level++; 
            include __FILE__; 
            $_level--; 
            extract($_menuData[$_level]);
        ?>
        </ul>
    <?endif;?>
    </li>
<?endforeach;?>

<?if (empty($_level)):?>
</ul>
<!-- menu end -->
<?endif?>
