<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2004-2007 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<?php 
/**
 * @methods
 * - getValue($key, $default)
 * - getSelected($key, $value)
 * - getChecked($key)
 * - getAttributes()
 * - getMappings()
 * - getAddMapButtonHtml()
 * - getRemoveMapButtonHtml()
 */
?>

<script type="text/javascript">
function showOption(select)
{
    select = $(select);
    for (var i = 0, l = select.options.length; i<l; i++) {
        $$('.'+select.id+'_'+select.options[i].value).each(function (el) {
            el.style.display = select.selectedIndex==i ? '' : 'none';
        });
    }

}

function addFieldMapping()
{
    var entityType = $('profile_entity_type').value;
    new Insertion.Bottom($('map_container_'+entityType), $('map_template_'+entityType).innerHTML);
}

function removeFieldMapping(button)
{
    Element.remove(button.parentNode);
}

function setMapFileField(select)
{
    select.parentNode.getElementsByTagName('input')[0].value = select.value;
}

function toggleSelectOption(type, source, target, sourceValue, targetValue, targetText)
{
    source = $(source);
    target = $(target);

    var i, ex, option, present;
    var selectValue = source.options[source.selectedIndex].value;

    if('remove'==type && selectValue==sourceValue || 'add'==type && selectValue!=sourceValue) {
        for(i=0;i<target.options.length;i++){
            if(target.options[i].value==targetValue){
                target.remove(i);
                break;
            }
        }
    } else {
        for(i=0;i<target.options.length;i++){
            if(target.options[i].value==targetValue){
                present = true;
                break;
            } else {
                present = false;
            }
        }
        if(!present){
            option = document.createElement("OPTION");
        	option.text = targetText;
        	option.value = targetValue;
        	try {
        		target.add(option, null); // standards compliant; doesn't work in IE
        	} catch(ex) {
        		target.add(option); // IE only
        	}
        }
    }
    showOption(target);
}

function changeEntityType()
{
    toggleSelectOption('remove', 'profile_entity_type', 'profile_direction', 'customer', 'import', '<?php echo $this->__('Import') ?>');
    toggleSelectOption('remove', 'profile_entity_type', 'profile_store_id', 'customer', '0', '<?php echo $this->__('Default Values') ?>');
    //showOption('profile_direction');
    changeDirection();
}


function changeDirection()
{
    toggleSelectOption('remove', 'profile_direction', 'profile_data_transfer', 'export', 'interactive', '<?php echo $this->__('Interactive') ?>');
    //showOption('profile_data_transfer');
}
</script>

<div id="profile-generator" class="entry-edit profile-generator">
    <h4 class="icon-head head-edit-form"><?php echo $this->__("Profile Information") ?></h4>
    <fieldset>
        <legend><?php echo $this->__("Profile Information") ?></legend>
        <table cellspacing="0" class="form-list">
            <tr>
                <td class="label"><?php echo $this->__("Name:") ?></td>
                <td class="input-ele"><input class="input-text" id="profile_name" name="name" value="<?php echo $this->getValue('name') ?>"/></td>
            </tr>
            <tr>
                <td class="label"><?php echo $this->__("Entity type:") ?></td>
                <td class="input-ele"><select id="profile_entity_type" name="entity_type" onchange="showOption(this);changeEntityType();" class="option-control">
                <option value="product" <?php echo $this->getSelected('entity_type', 'product') ?>><?php echo $this->__("Products") ?></option>
                <option value="customer" <?php echo $this->getSelected('entity_type', 'customer') ?>><?php echo $this->__("Customers") ?></option>
            </select></td>
            </tr>
            <tr>
                <td class="label"><?php echo $this->__("Direction:") ?></td>
                <td class="input-ele"><select id="profile_direction" name="direction" onchange="showOption(this);changeDirection();" class="option-control">
                <option value="import" <?php echo $this->getSelected('direction', 'import') ?>><?php echo $this->__("Import") ?></option>
                <option value="export" <?php echo $this->getSelected('direction', 'export') ?>><?php echo $this->__("Export") ?></option>
            </select></td>
            </tr>
            <tr>
                <td class="label"><?php echo $this->__("Store View:") ?></td>
                <td class="input-ele"><p><select id="profile_store_id" name="store_id">
                <?php foreach ($this->getStores() as $_value=>$_label): ?>
                    <option value="<?php echo $_value ?>" <?php echo $this->getSelected('store_id', $_value) ?>><?php echo htmlspecialchars($_label) ?></option>
                <?php endforeach ?> 
            </select></p>
            <span class="profile_direction_import profile_entity_type_product">
                    <?php echo $this->__("(Products will be added/updated to this store if 'store' column is blank or missing in the import file.)") ?>
            </span>
        </td>
      </table>
    </fieldset>

    <h4 class="icon-head head-edit-form"><?php echo $this->__("File Information") ?></h4>
    <fieldset>
        <legend><?php echo $this->__("File Information") ?></legend>
        <table cellspacing="0" class="form-list">
            <tr>
                <td class="label"><?php echo $this->__("Data transfer:") ?></td>
                <td class="input-ele"><select id="profile_data_transfer" name="data_transfer" onchange="showOption(this)" class="option-control">
                <option value="interactive" <?php echo $this->getSelected('data_transfer', 'interactive') ?>><?php echo $this->__("Interactive") ?></option>
                <option value="file" <?php echo $this->getSelected('data_transfer', 'file') ?>><?php echo $this->__("Local/Remote Server") ?></option>
                </select></td>
            </tr>
        <tr class="profile_data_transfer_file">
            <td class="label"><?php echo $this->__("Type:") ?></td>
            <td class="input-ele"><select id="file_type" name="gui_data[file][type]" onchange="showOption(this)" class="option-control">
                    <option value="file" <?php echo $this->getSelected('gui_data/file/type', 'file') ?>><?php echo $this->__("Local Server") ?></option>
                    <option value="ftp" <?php echo $this->getSelected('gui_data/file/type', 'ftp') ?>><?php echo $this->__("Remote FTP") ?></option>
                </select></td>
            </tr>
            <tr>
                <td class="label"><label for="file_filename"><?php echo $this->__("File name:") ?></td>
                <td class="input-ele"><input class="input-text" id="file_filename" name="gui_data[file][filename]" value="<?php echo $this->getValue('gui_data/file/filename') ?>"/></td>
            </tr>
            <tr>
                <td class="label"><?php echo $this->__("Path:") ?></td>
                <td class="input-ele"><p><input class="input-text" id="file_path" name="gui_data[file][path]" value="<?php echo $this->getValue('gui_data/file/path') ?>"/></p>
                <span class="file_type_file">
                    <?php echo $this->__('(Absolute path or Relative to Magento install root, ex. var/export)') ?>
                </span></td>
            </tr>
            <tr class="file_type_ftp">
                <td class="label"><?php echo $this->__("FTP Host[:Port]") ?></td>
                <td class="input-ele"><input class="input-text" id="file_host" name="gui_data[file][host]" value="<?php echo $this->getValue('gui_data/file/host') ?>"/></td>
            </tr>
            <tr>
                <td class="label"><?php echo $this->__("User name") ?></td>
                <td class="input-ele"><input class="input-text" id="file_user" name="gui_data[file][user]" value="<?php echo $this->getValue('gui_data/file/user') ?>"/></td>
            </tr>
            <tr>
                <td class="label"><?php echo $this->__("Password") ?></td>
                <td class="input-ele"><input class="input-text" id="io_password" name="gui_data[file][password]" value="<?php echo $this->getValue('gui_data/file/password') ?>"/></td>
            </tr>
            <tr>
                <td class="label"><?php echo $this->__("Passive mode") ?></td>
                <td class="input-ele"><select id="file_passive" name="gui_data[file][passive]" onchange="showOption(this)" class="option-control">
                        <option value="" <?php echo $this->getSelected('gui_data/file/passive', false) ?>><?php echo $this->__("No") ?></option>
                        <option value="true" <?php echo $this->getSelected('gui_data/file/passive', true) ?>><?php echo $this->__("Yes") ?></option>
                    </select></td>
             </tr>
           </table>
    </fieldset>

    <h4 class="icon-head head-edit-form"><?php echo $this->__("Data Format") ?></h4>
    <fieldset>
        <legend><?php echo $this->__("Data Format") ?></legend>
        <table cellspacing="0" class="form-list">
        <tr>
            <td class="label"><?php echo $this->__("Type:") ?></td>
            <td class="input-ele"><select id="parse_type" name="gui_data[parse][type]" onchange="showOption(this)" class="option-control">
                <option value="excel_xml" <?php echo $this->getSelected('gui_data/parse/type', 'excel_xml') ?>><?php echo $this->__("MS Excel XML") ?></option>
                <option value="csv" <?php echo $this->getSelected('gui_data/parse/type', 'csv') ?>><?php echo $this->__("CSV / Tab separated") ?></option>
            </select></td>
        </tr>
        <tr class="parse_type_excel_xml">
            <td class="label"><?php echo $this->__("Spreadsheet Name:") ?></td>
            <td class="input-ele"><p><input class="input-text" id="parse_single_sheet" name="gui_data[parse][single_sheet]" value="<?php echo $this->getValue('gui_data/parse/single_sheet') ?>"/></p><?php echo $this->__("(Leave empty for first spreadsheet)") ?></td>
        </tr>
        <tr class="parse_type_csv">
            <td class="label"><?php echo $this->__("Value Delimiter:") ?></td>
            <td class="input-ele"><input class="input-text" style="width:3em" id="parse_delimiter" name="gui_data[parse][delimiter]" value="<?php echo $this->getValue('gui_data/parse/delimiter', ',') ?>"/> <?php echo $this->__("(\\t for tab)") ?></td></tr>
       <tr>
            <td class="label"><?php echo $this->__("Enclose Values In:") ?></td>
            <td class="input-ele"><input class="input-text" style="width:3em" id="parse_enclose" name="gui_data[parse][enclose]" value="<?php echo $this->getValue('gui_data/parse/enclose', '"') ?>"/></td></tr>
        <tr>
            <td class="label"><?php echo $this->__("Field names in first row:") ?></td>
            <td class="input-ele"><p><select id="parse_fieldnames" name="gui_data[parse][fieldnames]" onchange="showOption(this)" class="option-control">
                <option value="" <?php echo $this->getSelected('gui_data/parse/fieldnames', false) ?>><?php echo $this->__("No") ?></option>
                <option value="true" <?php echo $this->getSelected('gui_data/parse/fieldnames', true) ?>><?php echo $this->__("Yes") ?></option>
            </select></p>
            <span class="profile_direction_import">
                <span class="parse_fieldnames_">
                    <?php echo $this->__("(When 'No', only mapped fields will be imported. When mapping, use 'column1', 'column2', etc.)") ?>
                </span>
            </span>
            </td>
         </tr>
        <tr class="profile_direction_export">
            <td class="label"><?php echo $this->__("Export:") ?></td>
            <td class="input-ele"><select id="map_only_specified" name="gui_data[map][only_specified]" onchange="showOption(this)">
                    <option value="" <?php echo $this->getSelected('gui_data/map/only_specified', false) ?>><?php echo $this->__("All fields") ?></option>
                    <option value="true" <?php echo $this->getSelected('gui_data/map/only_specified', true) ?>><?php echo $this->__("Only mapped fields") ?></option>
                </select></td>
        </tr>
      </table>
    </fieldset>

    <h4 class="icon-head head-edit-form"><?php echo $this->__("Field Mapping") ?></h4>
    <fieldset>
        <legend><?php echo $this->__("Field Mapping") ?></legend>
        <?php foreach (array('product', 'customer') as $_entityType): ?>
            <div class="profile_entity_type_<?php echo $_entityType ?>">
                <div id="map_template_<?php echo $_entityType ?>" style="display:none">
                    <p>
                        <?php echo $this->__("In Database:") ?> <select name="gui_data[map][<?php echo $_entityType ?>][db][]" onchange="setMapFileField(this)">
                            <?php foreach ($this->getAttributes($_entityType) as $_value=>$_label): ?>
                                <option value="<?php echo $_value ?>"><?php echo $_label ?></option>
                            <?php endforeach ?>
                        </select>
                        &lt;--&gt;
                        <?php echo $this->__("In File:") ?> <input class="input-text" name="gui_data[map][<?php echo $_entityType ?>][file][]"/>
                        <?php echo $this->getRemoveMapButtonHtml() ?>
                    </p>
                </div>
                <div id="map_container_<?php echo $_entityType ?>">
                    <?php foreach ($this->getMappings($_entityType) as $_i=>$_dbField): ?>
                        <p>
                            <?php echo $this->__("In Database:") ?> <select name="gui_data[map][<?php echo $_entityType ?>][db][]">
                            <?php foreach ($this->getAttributes($_entityType) as $_value=>$_label): ?>
                                <option value="<?php echo $_value ?>" <?php echo $this->getSelected('gui_data/map/'.$_entityType.'/db/'.$_i, $_value) ?>><?php echo $_label ?></option>
                            <?php endforeach ?>
                            </select>
                            &lt;--&gt;
                            <?php echo $this->__("In File:") ?> <input class="input-text" name="gui_data[map][<?php echo $_entityType ?>][file][]" value="<?php echo $this->getValue('gui_data/map/'.$_entityType.'/file/'.$_i) ?>"/>
                            <?php echo $this->getRemoveMapButtonHtml() ?>
                        </p>
                    <?php endforeach ?>
                </div>
            </div>
        <?php endforeach ?>
        <?php echo $this->getAddMapButtonHtml() ?>
    </fieldset>

    <div class="profile_direction_export">
        <h4 class="icon-head head-edit-form"><?php echo $this->__("Export Filters") ?></h4>
        <fieldset>
            <table cellspacing="0" class="form-list profile_entity_type_product">
                <tr>
                    <td class="label"><?php echo $this->__("Name:") ?></td>
                    <td class="input-ele"><input class="input-text" id="product_filter_name" name="gui_data[product][filter][name]" value="<?php echo $this->getValue('gui_data/product/filter/name') ?>"/>
                    <?php echo $this->__('(Starting with)') ?></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("SKU:") ?></td>
                    <td class="input-ele"><input class="input-text" id="product_filter_sku" name="gui_data[product][filter][sku]" value="<?php echo $this->getValue('gui_data/product/filter/sku') ?>"/>
                    <?php echo $this->__('(Starting with)') ?></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Type:") ?></td>
                    <td class="input-ele"><select id="product_filter_type" name="gui_data[product][filter][type]">
                        <?php foreach ($this->getProductTypeFilterOptions() as $_value=>$_label): ?>
                            <option value="<?php echo $_value ?>" <?php echo $this->getSelected('gui_data/product/filter/type', $_value) ?>><?php echo htmlspecialchars($_label) ?></option>
                        <?php endforeach ?>
                    </select></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Attribute Set Name:") ?></td>
                    <td class="input-ele"><select id="product_filter_attribute_set" name="gui_data[product][filter][attribute_set]">
                        <?php foreach ($this->getProductAttributeSetFilterOptions() as $_value=>$_label): ?>
                            <option value="<?php echo $_value ?>" <?php echo $this->getSelected('gui_data/product/filter/attribute_set', $_value) ?>><?php echo htmlspecialchars($_label) ?></option>
                        <?php endforeach ?>
                    </select></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Price:") ?></td>
                    <td class="input-ele">
                    <input class="input-text" style="width:5em" id="product_filter_price_from" name="gui_data[product][filter][price][from]" value="<?php echo $this->getValue('gui_data/product/filter/price/from') ?>"/> <?php echo $this->__('to') ?>
                    <input class="input-text" style="width:5em" id="product_filter_price_to" name="gui_data[product][filter][price][to]" value="<?php echo $this->getValue('gui_data/product/filter/price/to') ?>"/></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Stock Quantity:") ?></td>
                    <td class="input-ele"><input class="input-text" style="width:5em" id="product_filter_qty_from" name="gui_data[product][filter][qty][from]" value="<?php echo $this->getValue('gui_data/product/filter/qty/from') ?>"/> <?php echo $this->__('to') ?>
                    <input class="input-text" style="width:5em" id="product_filter_qty_to" name="gui_data[product][filter][qty][to]" value="<?php echo $this->getValue('gui_data/product/filter/qty/to') ?>"/></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Visibility:") ?></td>
                    <td class="input-ele"><select id="product_filter_visibility" name="gui_data[product][filter][visibility]">
                        <?php foreach ($this->getProductVisibilityFilterOptions() as $_value=>$_label): ?>
                            <option value="<?php echo $_value ?>" <?php echo $this->getSelected('gui_data/product/filter/visibility', $_value) ?>><?php echo htmlspecialchars($_label) ?></option>
                        <?php endforeach ?>
                    </select></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Status:") ?></td>
                    <td class="input-ele"><select id="product_filter_status" name="gui_data[product][filter][status]">
                        <?php foreach ($this->getProductStatusFilterOptions() as $_value=>$_label): ?>
                            <option value="<?php echo $_value ?>" <?php echo $this->getSelected('gui_data/product/filter/status', $_value) ?>><?php echo htmlspecialchars($_label) ?></option>
                        <?php endforeach ?>
                    </select></td>
                </tr>
            </table>
            <table cellspacing="0" class="form-list profile_entity_type_customer">
                <tr>
                    <td class="label"><?php echo $this->__("First Name:") ?></td>
                    <td class="input-ele"><input class="input-text" id="customer_filter_firstname" name="gui_data[customer][filter][firstname]" value="<?php echo $this->getValue('gui_data/customer/filter/firstname') ?>"/>
                    <?php echo $this->__('(Starting with)') ?></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Last Name:") ?></td>
                    <td class="input-ele"><input class="input-text" id="customer_filter_lastname" name="gui_data[customer][filter][lastname]" value="<?php echo $this->getValue('gui_data/customer/filter/lastname') ?>"/>
                    <?php echo $this->__('(Starting with)') ?>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Email:") ?></td>
                    <td class="input-ele"><input class="input-text" id="customer_filter_email" name="gui_data[customer][filter][email]" value="<?php echo $this->getValue('gui_data/customer/filter/email') ?>"/>
                    <?php echo $this->__('(Starting with)') ?></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Group:") ?></td>
                    <td class="input-ele"><select id="customer_filter_group" name="gui_data[customer][filter][group]">
                        <?php foreach ($this->getCustomerGroupFilterOptions() as $_value=>$_label): ?>
                            <option value="<?php echo $_value ?>" <?php echo $this->getSelected('gui_data/customer/filter/group', $_value) ?>><?php echo htmlspecialchars($_label) ?></option>
                        <?php endforeach ?>
                    </select></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Address Type:") ?></td>
                    <td class="input-ele"><select id="customer_filter_adressType" name="gui_data[customer][filter][adressType]" >
                            <option value="default_billing" <?php echo $this->getSelected('gui_data/customer/filter/adressType', 'default_billing') ?>><?php echo $this->__('Billing Address') ?></option>
                            <option value="default_shipping" <?php echo $this->getSelected('gui_data/customer/filter/adressType', 'default_shipping') ?>><?php echo $this->__('Shipping Address') ?></option>
                    </select></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Phone:") ?></td>
                    <td class="input-ele"><input class="input-text" id="customer_filter_telephone" name="gui_data[customer][filter][telephone]" value="<?php echo $this->getValue('gui_data/customer/filter/telephone') ?>"/>
                    <?php echo $this->__('(Starting with)') ?></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Zip/Postal Code:") ?></td>
                    <td class="input-ele"><input class="input-text" id="customer_filter_postcode" name="gui_data[customer][filter][postcode]" value="<?php echo $this->getValue('gui_data/customer/filter/postcode') ?>"/></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Country:") ?></td>
                    <td class="input-ele"><select id="customer_filter_country" name="gui_data[customer][filter][country]">
                        <?php foreach ($this->getCountryFilterOptions() as $_value): ?>
                            <option value="<?php echo $_value['value'] ?>" <?php echo $this->getSelected('gui_data/customer/filter/country', $_value['value']) ?>><?php echo htmlspecialchars($_value['label']) ?></option>
                        <?php endforeach ?>
                    </select></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("State/Province:") ?></td>
                    <td class="input-ele"><input class="input-text" id="customer_filter_region" name="gui_data[customer][filter][region]" value="<?php echo $this->getValue('gui_data/customer/filter/region') ?>"/>
                    <?php echo $this->__('(For US 2-letter state names)') ?></td>
                </tr>
                <tr>
                    <td class="label"><?php echo $this->__("Customer Since:") ?></td>
                    <td class="input-ele"><input class="input-text" style="width:5em" id="customer_filter_created_at_from" name="gui_data[customer][filter][created_at][from]" value="<?php echo $this->getValue('gui_data/customer/filter/created_at/from') ?>"/>
                    <img src="<?php echo $this->getSkinUrl('images/grid-cal.gif') ?>" alt="" id="customer_filter_created_at_from_trig" title="<?php echo $this->__('Date selector') ?>" class="v-middle"/>
                     <?php echo $this->__('to') ?>
                    <input class="input-text" style="width:5em" id="customer_filter_created_at_to" name="gui_data[customer][filter][created_at][to]" value="<?php echo $this->getValue('gui_data/customer/filter/created_at/to') ?>"/>
                    <img src="<?php echo $this->getSkinUrl('images/grid-cal.gif') ?>" alt="" id="customer_filter_created_at_to_trig" title="<?php echo $this->__('Date selector') ?>" class="v-middle"/>
<script type="text/javascript">
    Calendar.setup({
        inputField : "customer_filter_created_at_from",
        ifFormat : "<?php echo $this->getShortDateFormat() ?>",
        button : "customer_filter_created_at_from_trig",
        align : "Bl",
        singleClick : true
    });
    Calendar.setup({
        inputField : "customer_filter_created_at_to",
        ifFormat : "<?php echo $this->getShortDateFormat() ?>",
        button : "customer_filter_created_at_to_trig",
        align : "Bl",
        singleClick : true
    });
</script>
                </td>
            </tr>
            </table>
        </fieldset>
    </div>

</div>

<script type="text/javascript">
    $$('.option-control').each(showOption);
    changeEntityType();
</script>
