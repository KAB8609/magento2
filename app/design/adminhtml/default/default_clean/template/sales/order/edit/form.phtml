<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2004-2007 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<div>
<form id="edit_form" action="<?=$this->getSaveUrl()?>" method="POST">
    <? $_order = $this->getOrder() ?>
    <input type="hidden" name="order_id" value="<?=$_order->getId()?>"/>
    <div class="box-left">
        <div class="entry-view">
            <h4><?=Mage::helper('sales')->__('Order Date: %s', $this->getOrderDateFormatted())?></h4>
        </div>
        <div class="entry-view">
            <h4><?=Mage::helper('sales')->__('Shipping Address')?></h4>
            <div class="box customer-personal-brief">
                <?$_shipping = $_order->getShippingAddress()?>
                <address><?=$_shipping->getFirstname()?> <?=$_shipping->getLastname()?><br/>
                <?=$_shipping->getCompany()?><br/>
                <?=$_shipping->getStreet()?><br/>
                <?=$_shipping->getCity()?>, <?=$_shipping->getRegion()?> <?=$_shipping->getPostcode()?><br/>
                <strong>T</strong> | <?=$_shipping->getTelephone();
                if ($_shipping->getFax()):?><br /><strong>F</strong> | <?=$_shipping->getFax()?><?endif;?>
                </address>
            </div>
        </div>
        <div class="entry-view">
            <h4><?=Mage::helper('sales')->__('Shipping Method')?></h4>
            <div class="box customer-personal-brief">
                <?=$_order->getShippingDescription()?>
            </div>
        </div>
    </div>
    <div class="box-right">
        <div class="entry-view">
            <h4><?=Mage::helper('sales')->__('Order Status: %s', $this->getOrderStatus())?></h4>
        </div>
        <div class="entry-view">
            <h4><?=Mage::helper('sales')->__('Billing Address')?></h4>
            <div class="box customer-personal-brief">
                <?$_billing = $_order->getbillingAddress()?>
                <address><?=$_billing->getFirstname()?> <?=$_billing->getLastname()?><br/>
                <?=$_billing->getCompany()?><br/>
                <?=$_billing->getStreet()?><br/>
                <?=$_billing->getCity()?>, <?=$_billing->getRegion()?> <?=$_billing->getPostcode()?><br/>
                <strong>T</strong> | <?=$_billing->getTelephone();
                if ($_billing->getFax()):?><br /><strong>F</strong> | <?=$_billing->getFax()?><?endif;?></address>
            </div>
        </div>
        <div class="entry-view">
            <h4><?=Mage::helper('sales')->__('Payment Method')?></h4>
            <div class="box customer-personal-brief">
                <?=$this->getPaymentInfoHtml()?>
            </div>
        </div>
    </div>
    <div class="clear"></div>
    <div class="entry-view">
        <h4><?=Mage::helper('sales')->__('Items Ordered')?></h4>
    </div>
    <div>
        <?=$this->getItemsHtml()?>
    </div>
    <div class="box order-totals">
        <table cellspacing="0">
            <tfoot>
                <tr><td class="label"><strong><?=Mage::helper('sales')->__('Grand Total')?></strong></td><td class="emph"><strong><?=$_order->getOrderCurrency()->format($_order->getGrandTotal())?></strong></td></tr>
                <?/*<tr><td class="label"><strong><?=Mage::helper('sales')->__('Total Paid')?></strong></td><td class="emph"><strong><?=$_order->getOrderCurrency()->format($_order->getTotalPaid())?></strong></td></tr>
                <tr><td class="label"><strong><?=Mage::helper('sales')->__('Total Due')?></strong></td><td class="emph"><strong><?=$_order->getOrderCurrency()->format($_order->getTotalDue())?></strong></td></tr>*/?>
            </tfoot>
            <tbody>
                <tr><td><?=Mage::helper('sales')->__('Subtotal')?></td><td><?=$_order->getOrderCurrency()->format($_order->getSubtotal())?>&nbsp</td></tr>
                <?if ($_order->getTaxAmount()):?><tr><td><?=Mage::helper('sales')->__('Tax')?></td><td><?=$_order->getOrderCurrency()->format($_order->getTaxAmount())?>&nbsp</td></tr><?endif;?>
                <?if ($_order->getShippingAmount()):?><tr><td><?=Mage::helper('sales')->__('Shipping')?></td><td><?=$_order->getOrderCurrency()->format($_order->getShippingAmount())?>&nbsp</td></tr><?endif;?>
                <?if ($_order->getDiscountAmount()):?><tr><td><?=Mage::helper('sales')->__('Discount')?></td><td><?=$_order->getOrderCurrency()->format($_order->getDiscountAmount())?>&nbsp</td></tr><?endif;?>
                <?if ($_order->getGiftcertAmount()):?><tr><td><?=Mage::helper('sales')->__('Gift Certificate')?></td><td><?=$_order->getOrderCurrency()->format($_order->getGiftcertAmount())?>&nbsp</td></tr><?endif;?>
                <?if ($_order->getCustbalanceAmount()):?><tr><td><?=Mage::helper('sales')->__('Customer Balance')?></td><td><?=$_order->getOrderCurrency()->format($_order->getCustbalanceAmount())?>&nbsp</td></tr><?endif;?>
            </tbody>
        </table>
    </div>
    <div class="clear"><h4><?=Mage::helper('sales')->__('Order History')?></h4></div>
    <div class="box-left">
        <div class="grid">
            <table cellspacing="0" class="data" id="invoice_items_grid_table">
                <thead>
                    <tr class="headings">
                        <th class="no-link"><nobr><?=Mage::helper('sales')->__('Date and Time')?></nobr></th>
                        <th class="no-link"><nobr><?=Mage::helper('sales')->__('Order Status')?></nobr></th>
                        <th class="no-link"><nobr><?=Mage::helper('sales')->__('Comment')?></nobr></th>
                    </tr>
                </thead>
                <tbody>
                    <?foreach ($this->getOrder()->getAllStatusHistory() as $_history):?>
                        <tr>
                            <td class="a-center"><nobr><?=$this->formatDate($_history->getCreatedAt(), 'medium')?></nobr>&nbsp;</td>
                            <td><?=$_history->getStatus()->getFrontendLabel()?>&nbsp</td>
                            <td><?=$_history->getComments()?>&nbsp;</td>
                        </tr>
                    <?endforeach;?>
                </tbody>
            </table>
        </div>
    </div>
    <div class="box-left">
        <div style="padding: 0 2em;">
            <div class="clear" style="height:20px;">
                <h4 style="float:left; width: 11em;"><?=Mage::helper('sales')->__('Change Order Status')?></h4>
                <select style="float:left; width: 10em;" name="new_status">
                    <?foreach ($this->getStatuses() as $_statusId => $_statusLabel):?>
                        <option value="<?=$_statusId?>"<?=($this->getOrder()->getOrderStatusId() == $_statusId ? ' selected' : '')?>><?=$_statusLabel?></option>
                    <?endforeach;?>
                </select>
            </div>
            <div>
                <h4><?=Mage::helper('sales')->__('Order Comment:')?></h4>
                <textarea style="width: 100%; height: 10em;" name="comments"></textarea>
            </div>
            <div>
                <input type="checkbox" id="notify_customer" name="notify_customer" value="1"> <label for="notify_customer"><?=Mage::helper('sales')->__('Send Comment to the Customer')?></label>
            </div>
        </div>
    </div>
    <div class="clear"></div>
    <?if($this->helper('giftmessage/message')->getIsMessagesAviable('order', $this->getOrder(), $this->getOrder()->getStoreId())):?>
    <div class="box-left">
        <div id="order:gift_message">
        <div class="entry-edit">
            <div>
            <h4 class="fieldset-legend head-gift-message"><?=$this->__('Gift Message')?></h4>
            <div class="clear"></div>
            </div>
            <fieldset>
                <?=$this->helper('giftmessage/message')->getAdminButton('order', $this->getOrder(), $this->getOrder()->getStoreId());?>
            </fieldset>
        </div>
        </div>
    </div>
    <div class="clear"></div>
    <?endif;?>
</form>
</div>