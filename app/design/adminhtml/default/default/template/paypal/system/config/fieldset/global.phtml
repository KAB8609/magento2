<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2009 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * @see Mage_Paypal_Block_System_Config_Fieldset_Global
 */
?>

<table class="paypal-global" id="paypal_checkout" cellspacing="0">
    <col />
    <col width="90" />
    <col width="10" />
    <col width="90" />
    <col width="10" />
    <col width="90" />
    <col width="90" />
    <thead>
        <tr>
            <th class="pg-empty" rowspan="2">&nbsp;</th>
            <th><label for="paypal_global_express"><?php echo Mage::helper('paypal')->__('Express Checkout')?></label></th>
            <th class="pg-empty" rowspan="2">&nbsp;</th>
            <th><label for="paypal_global_standard"><?php echo Mage::helper('paypal')->__('Standard')?></label></th>
            <th class="pg-empty" rowspan="2">&nbsp;</th>
            <th><label for="paypal_global_pro"><?php echo Mage::helper('paypal')->__('Pro')?></label></th>
            <!-- th><label for="paypal_global_pro"><?php echo Mage::helper('paypal')->__('WPP PE')?></label></th -->
            <th><label for="paypal_global_gateway"><?php echo Mage::helper('paypal')->__('Payflow Pro')?></label></th>
        </tr>
        <tr>
            <th>
                <?php echo $this->getCheckboxHtml('paypal_global_express') ?>
                <?php if ($this->canUseInherit('paypal_global_express')): ?>
                    <span><?php echo $this->getInheritCheckboxHtml('paypal_global_express') ?><?php echo $this->getInheritCheckboxLabelHtml('paypal_global_express') ?></span>
                <?php endif; ?>
            </th>
            <th>
                <?php echo $this->getCheckboxHtml('paypal_global_standard') ?>
                <?php if ($this->canUseInherit('paypal_global_standard')): ?>
                    <span><?php echo $this->getInheritCheckboxHtml('paypal_global_standard') ?><?php echo $this->getInheritCheckboxLabelHtml('paypal_global_standard') ?></span>
                <?php endif; ?>
            </th>
            <!-- th>
                <input type="radio" name="pro">
            </th>
            <th>
                <input type="radio" name="pro">
            </th>
            <th>
                <input type="radio" name="pro">
            </th -->
            <th>
                <?php echo $this->getCheckboxHtml('paypal_global_pro') ?>
                <?php if ($this->canUseInherit('paypal_global_pro')): ?>
                    <span><?php echo $this->getInheritCheckboxHtml('paypal_global_pro') ?><?php echo $this->getInheritCheckboxLabelHtml('paypal_global_pro') ?></span>
                <?php endif; ?>
            </th>
            <th>
                <?php echo $this->getCheckboxHtml('paypal_global_gateway') ?>
                <?php if ($this->canUseInherit('paypal_global_gateway')): ?>
                    <span><?php echo $this->getInheritCheckboxHtml('paypal_global_gateway') ?><?php echo $this->getInheritCheckboxLabelHtml('paypal_global_gateway') ?></span>
                <?php endif; ?>
            </th>
        </tr>
    </thead>
    <tbody>
        <?php  foreach ($this->getFeatures() as $feature => $info): ?>
        <tr>
            <td>
                <?php echo $info['label'] ?>
                <?php if (isset($info['comment']) && $info['comment']): ?>
                    <p class="paypal-note">(<?php echo $info['comment'] ?>)</p>
                <?php endif; ?>
            </td>
            <td><?php echo ($this->getMethodFeature('express', $feature) ? '<span class="pg-tick"></span>' : '') ?></td>
            <td class="pg-empty">&nbsp;</td>
            <td><?php echo ($this->getMethodFeature('standard', $feature) ? '<span class="pg-tick"></span>' : '') ?></td>
            <td class="pg-empty">&nbsp;</td>
            <td><?php echo ($this->getMethodFeature('pro', $feature) ? '<span class="pg-tick"></span>' : '') ?></td>
            <!-- td><?php echo ($this->getMethodFeature('pro', $feature) ? '<span class="pg-tick"></span>' : '') ?></td -->
            <td><?php echo ($this->getMethodFeature('gateway', $feature) ? '<span class="pg-tick"></span>' : '') ?></td>
        </tr>
        <?php endforeach; ?>
        <tr>
            <td class="pg-empty">&nbsp;</td>
            <td><a href="#"><?php echo Mage::helper('paypal')->__('View Demo')?></a> <a href="#"><?php echo Mage::helper('paypal')->__('Learn more')?></a></td>
            <td class="pg-empty">&nbsp;</td>
            <td><a href="#"><?php echo Mage::helper('paypal')->__('View Demo')?></a> <a href="#"><?php echo Mage::helper('paypal')->__('Learn more')?></a></td>
            <td class="pg-empty">&nbsp;</td>
            <td><a href="#"><?php echo Mage::helper('paypal')->__('View Demo')?></a> <a href="#"><?php echo Mage::helper('paypal')->__('Learn more')?></a></td>
            <td><a href="#"><?php echo Mage::helper('paypal')->__('View Demo')?></a> <a href="#"><?php echo Mage::helper('paypal')->__('Learn more')?></a></td>
            <!-- td><a href="#"><?php echo Mage::helper('paypal')->__('View Demo')?></a> <a href="#"><?php echo Mage::helper('paypal')->__('Learn more')?></a></td -->
        </tr>
    </tbody>
</table>
<p class="pg-options"><a href="#">Print</a>&nbsp;|&nbsp;<a href="#">Email</a> this table</p>

<script type="text/javascript">
decorateTable('paypal_checkout');

Event.observe(window, 'load', function() {
    var pConfig = new PaypalConfig;

    // toggle Payflow Edition(UK) dependance
    Element.observe('paypal_general_merchant_country', 'change', pConfig.trackPayflowEnabled.bind(pConfig));
    Element.observe('paypal_general_use_payflow', 'change', pConfig.trackPayflowEnabled.bind(pConfig));
    pConfig.trackPayflowEnabled();

    // toggle method fieldsets based on methods availability
    Element.observe('paypal_global_express', 'click', pConfig.toggleFieldset.bind(pConfig, 'paypal_express', 'paypal_global_express'));
    Element.observe('paypal_global_standard', 'click', pConfig.toggleFieldset.bind(pConfig, 'paypal_standard', 'paypal_global_standard'));
    Element.observe('paypal_global_pro', 'click', pConfig.toggleFieldset.bind(pConfig, 'paypal_pro', 'paypal_global_pro'));
    Element.observe('paypal_global_gateway', 'click', pConfig.toggleFieldset.bind(pConfig, 'paypal_verisign', 'paypal_global_gateway'));
    if (!$('paypal_global_express').checked) {
        pConfig.toggleFieldset('paypal_express', 'paypal_global_express');
    }
    if (!$('paypal_global_standard').checked) {
        pConfig.toggleFieldset('paypal_standard', 'paypal_global_standard');
    }
    if (!$('paypal_global_pro').checked) {
        pConfig.toggleFieldset('paypal_pro', 'paypal_global_pro');
    }
    if (!$('paypal_global_gateway').checked) {
        pConfig.toggleFieldset('paypal_verisign', 'paypal_global_gateway');
    }
});

PaypalConfig = Class.create();
PaypalConfig.prototype = {
    initialize: function(){},

    trackPayflowEnabled: function()
    {
        var usePayflow = $('paypal_general_merchant_country') != undefined
            && $('paypal_general_merchant_country').value == 'GB'
            && $('paypal_general_use_payflow') != undefined
            && $('paypal_general_use_payflow').value == '1';
        var payflowRows = [
            'row_paypal_pro_heading_payflow',
            'row_paypal_pro_partner',
            'row_paypal_pro_user',
            'row_paypal_pro_vendor',
            'row_paypal_pro_pwd'
        ];
        var notPayflowRows = [
            'row_paypal_general_heading_api',
            'row_paypal_general_api_username',
            'row_paypal_general_api_password',
            'row_paypal_general_api_signature',
            'row_paypal_general_use_proxy'
        ];
        if (usePayflow) {
            payflowRows.each(function(e) {
                this.enableRow(e);
            }.bind(this));
            notPayflowRows.each(function(e) {
                this.disableRow(e);
            }.bind(this));
        } else {
            payflowRows.each(function(e) {
                this.disableRow(e);
            }.bind(this));
            notPayflowRows.each(function(e) {
                this.enableRow(e);
            }.bind(this));
        }
        //this.trackProductFeatures();
    },

    trackProductFeatures: function()
    {
        var countryConfig = $H({
            'US':{
                'exclude_methods': [],
                'exclude_fields': []
            },
            'CA':{
                'exclude_methods': ['pro'],
                'exclude_fields': []
            },
            'GB':{
                'exclude_methods': ['gateway'],
                'exclude_fields': []
            },
            'AU':{
                'exclude_methods': ['pro'],
                'exclude_fields': []
            },
            'NZ':{
                'exclude_methods': ['pro'],
                'exclude_fields': []
            },
            'DE':{
                'exclude_methods': ['pro','gateway'],
                'exclude_fields': []
            },
            'other':{
                'exclude_methods': ['pro','gateway'],
                'exclude_fields': []
            }
        });
        var country = $('paypal_general_merchant_country').value;
        if (countryConfig.get(country)) {
            var excludeMethods = countryConfig.get(country).exclude_methods;
            excludeMethods.each(function(method) {
                $('paypal_global_' + method).checked = false;
                $('paypal_global_' + method).disabled = true;
            })
        }
    },

    enableRow: function(rowId)
    {
        $(rowId).select('input','select').each(function(e) {
            e.disabled = false;
        });
        $(rowId).show();
    },

    disableRow: function(rowId)
    {
        $(rowId).select('input','select').each(function(e) {
            e.disabled = true;
        });
        $(rowId).hide();
    },

    toggleFieldset: function(fieldset, checkbox)
    {
        var isHidden = !$(checkbox).checked;
        toggleValueElements(checkbox, fieldset, [], isHidden);
        isHidden ? $(fieldset).hide() : $(fieldset).show();
        var heading = $(fieldset).previous('div');
        var headingLink = heading.down('a');
        isHidden ? heading.addClassName('disabled') : heading.removeClassName('disabled');
        if (isHidden) {
            headingLink.oldHref = headingLink.href;
            headingLink.oldOnclick = headingLink.onclick;
            headingLink.onclick = "return false;";
            headingLink.href = "javascript:void(0)";
        } else {
            headingLink.onclick = headingLink.oldOnclick;
            headingLink.href = headingLink.oldHref;
        }
    }
}
</script>
