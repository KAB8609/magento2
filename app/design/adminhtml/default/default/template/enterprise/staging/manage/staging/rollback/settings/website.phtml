<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design_default
 * @package    Enterprise
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php /* @var $this Enterprise_Staging_Block_Manage_Staging_Rollback_Settings_Website */?>
<?php $event            = $this->getEvent(); ?>
<?php $backup          = $this->getBackup(); ?>
<?php $staging          = $this->getStaging(); ?>
<?php $items            = $staging->getItemsCollection(); ?>
<?php $masterWebsites   = $this->getWebsiteCollection(); ?>
<?php $stores           = $this->getAllStoresCollection(); ?>
<?php $stagingWebsites  = $staging->getWebsitesCollection(); ?>
<?php $mapperUsedItems  = $this->getMapper()->getUsedItems(); ?>
<?php $mapperWebSites   = $this->getMapper()->getAllUsedWebsites();?>
 
<?php if ($this->getIsVersionConflict()): ?>
    <div id="messages">
    <ul class="messages">
        <li class="notice-msg">
            <?php echo $this->__('Module version conflict!'); ?>
        </li>            
    </ul>
    </div>
<?php endif; ?>     

<form action="<?php echo $this->getSaveUrl() ?>" method="post" id="enterprise_staging_rollback_form" enctype="multipart/form-data">
<input type="hidden" name="staging_id" value="<?php echo $staging->getId(); ?>">
<input type="hidden" name="backup_id" value="<?php echo $backup->getId(); ?>">

<?php if($this->getPagerVisibility() || $this->getExportTypes() || $this->getFilterVisibility()): ?>
    <table cellspacing="0" class="actions">
        <tr>
    <?php if($this->getExportTypes()): ?>
        <td class="export a-right">
            <img src="<?php echo $this->getSkinUrl('images/icon_export.gif') ?>" alt="" class="v-middle"/>&nbsp; <?php echo $this->__('Export to:') ?>
            <select name="<?php echo $this->getId() ?>_export" id="<?php echo $this->getId() ?>_export" style="width:8em;">
            <?php foreach ($this->getExportTypes() as $_type): ?>
                <option value="<?php echo $_type->getUrl() ?>"><?php echo $_type->getLabel() ?></option>
            <?php endforeach; ?>
            </select>
            <?php echo $this->getExportButtonHtml() ?>
        </td>
    <?php endif; ?>
        <td class="filter-actions a-right">
            <?php echo $this->getMainButtonsHtml() ?>
        </td>
        </tr>
    </table>
<?php endif; ?>
<?php if($this->getMassactionBlock()->isAvailable()): ?>
<?php echo $this->getMassactionBlockHtml() ?>
<?php endif ?>
<div id="enterprise_staging_rollback_container" class="grid">

    <!-- table cellspacing="0" cellpadding="0" style="width:210px;" class="option-header">
    <thead>
    <tr class="headings">
        <th><?php echo $this->__('Website'); ?></th>
        <th><?php echo $this->__('Store'); ?></th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    <?php foreach($mapperWebSites AS $mapperWebSiteInfo): ?>
        <?php if (isset($mapperWebSiteInfo["master_website"])): ?>
        
            <?php foreach($mapperWebSiteInfo["master_website"] AS $toSiteId => $fromSiteId): ?>
                <input type="hidden" name="map[websites][from][]" value="<?php echo $fromSiteId; ?>">
                <input type="hidden" name="back" value="1" />
                <?php $siteInfo = $masterWebsites->getItemByColumnValue("website_id", $toSiteId); ?>
                <tr>
                    <td style="width:100px;"><?php echo $siteInfo->getName(); ?></td>
                    <td style="width:100px;"></td>
                    <td style="width:10px;"><input type="checkbox" name="map[websites][to][]" value="<?php echo $toSiteId; ?>" /></td>
                </tr>                
                <?php if (isset($mapperWebSiteInfo["stores"][$toSiteId])): ?>
                <?php foreach($stores AS $storeInfo): ?>
                    <?php if ($fromStoreId = array_search($storeInfo->getId(), $mapperWebSiteInfo["stores"][$toSiteId])): ?>
                        <input type="hidden" name="map[stores][<?php echo $fromSiteId . '-' . $toSiteId; ?>][from][]" value="<?php echo $fromStoreId; ?>" />                    
                        <tr>        
                            <td style="width:100px;"></td>                    
                            <td style="width:100px;"><?php echo $storeInfo->getName();?></td>
                            <td style="width:10px;"><input type="checkbox" name="map[stores][<?php echo $fromSiteId . '-' . $toSiteId; ?>][to][]" value="<?php echo $storeInfo->getId() ?>" /></td>                            
                        </tr> 
                    <?php endif; ?>                       
                <?php endforeach; ?>
                <?php endif; ?>
            <?php endforeach; ?>
        <?php endif; ?>
    <?php endforeach; ?>
    </tbody>
    </table-->

    
    <?php foreach($mapperWebSites AS $mapperWebSiteInfo): ?>
        <?php if (isset($mapperWebSiteInfo["master_website"])): ?>
        
            <?php foreach($mapperWebSiteInfo["master_website"] AS $toSiteId => $fromSiteId): ?>
                <input type="hidden" name="map[websites][from][]" value="<?php echo $fromSiteId; ?>">
                <input type="hidden" name="back" value="1" />
                <?php $siteInfo = $masterWebsites->getItemByColumnValue("website_id", $toSiteId); ?>
                <input type="hidden" name="map[websites][to][]" value="<?php echo $toSiteId; ?>" />
                <?php if (isset($mapperWebSiteInfo["stores"][$toSiteId])): ?>
                <?php foreach($stores AS $storeInfo): ?>
                    <?php if ($fromStoreId = array_search($storeInfo->getId(), $mapperWebSiteInfo["stores"][$toSiteId])): ?>
                        <input type="hidden" name="map[stores][<?php echo $fromSiteId . '-' . $toSiteId; ?>][from][]" value="<?php echo $fromStoreId; ?>" />                    
                        <input type="hidden" name="map[stores][<?php echo $fromSiteId . '-' . $toSiteId; ?>][to][]" value="<?php echo $storeInfo->getId() ?>" />                            
                    <?php endif; ?>                       
                <?php endforeach; ?>
                <?php endif; ?>
            <?php endforeach; ?>
        <?php endif; ?>
    <?php endforeach; ?>
    
<?php echo $this->getBlockHtml('formkey')?>
<?php echo $this->getChildHtml('items'); ?>
</form>
</div>
<script type="text/javascript">
//<![CDATA[
<?php echo $this->getJsObjectName() ?> = new Enterprise.Staging.Form('enterprise_staging_rollback_container', 'enterprise_staging_rollback_form', '', '', [],[]);
//]]>
</script>