<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design
 * @package    default_default
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<script type="text/javascript">
var Wysiwyg = {};
Wysiwyg.Images = Class.create();
Wysiwyg.Images.prototype = {
    tree: null,
    currentDir: null,
    contentsUrl: null,

    initialize: function () {
        this.contentsUrl = '<?php echo $this->getContentsUrl() ?>';
    },

    setTree: function (tree) {
        this.tree = tree;
        this.currentDir = tree.getRootNode().id;
    },

    getTree: function (tree) {
        return this.tree;
    },

    directoryClick: function (node, event) {
        this.activateBlock('contents');
        this.currentDir = node.id;
        var url = this.contentsUrl;
        if (!url.match(new RegExp('[?&]isAjax=true',''))) {
            url = url.match(new RegExp('\\?',"g")) ? url + '&isAjax=true' : url + '?isAjax=true';
        }

        new Ajax.Request(url, {
            parameters: {form_key: FORM_KEY, node: this.currentDir},
            evalJS: true,
            onSuccess: function(transport) {
                try {
                    if (transport.responseText.isJSON()) {
                        var response = transport.responseText.evalJSON()
                        if (response.error) {
                            alert(response.message);
                        }
                        if(response.ajaxExpired && response.ajaxRedirect) {
                            setLocation(response.ajaxRedirect);
                        }
                    } else {
                        $('contents').update(transport.responseText);
                    }
                }
                catch (e) {
                    $('contents').update(transport.responseText);
                }
            }
        });
    },

    upload: function() {
        this.activateBlock('contents-uploader');
    },

    newFolder: function() {
        var folderName = prompt('<?php echo $this->__('New folder name') ?>:');
        new Ajax.Request('<?php echo $this->getNewfolderUrl() ?>', {
            parameters: {form_key: FORM_KEY, name: folderName},
            onSuccess: function(transport) {
                try {
                    if (transport.responseText.isJSON()) {
                        var response = transport.responseText.evalJSON()
                        if (response.error) {
                            alert(response.message);
                        }
                        if(response.ajaxExpired && response.ajaxRedirect) {
                            setLocation(response.ajaxRedirect);
                        }
                    }
                }
                catch (e) {
                    $('contents').update(transport.responseText);
                }
            }
        });
    },

    activateBlock: function(id) {
        $$('div [id^=contents]').each(this.hideElement);
        this.showElement(id);
    },

    hideElement: function(id) {
        $(id).addClassName('no-display');
        $(id).hide();
    },

    showElement: function(id) {
        $(id).removeClassName('no-display');
        $(id).show();
    }
}

Images = new Wysiwyg.Images();
</script>
