<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2004-2007 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<?
/**
 * Multishipping checkout shipping template
 * 
 * @see Mage_Checkout_Block_Multishipping_Shipping
 */
?>
<div class="page-head">
    <h2>Select Shipping Method</h2>
</div>
<?=$this->getMessagesBlock()->getGroupedHtml()?>
<form action="<?=$this->getPostActionUrl()?>" method="post">
<?foreach ($this->getAddresses() as $_index => $_address):?>
<h3>Address <span class="shipment-count"><?=($_index+1)?></span> of <?=$this->getAddressCount()?></h3>
<div class="generic-box col2-alt-set">
    <div class="col-1">
        <div class="head">
            <h4>Shipping to<span class="separator">|</span><a href="<?=$this->getAddressEditUrl($_address)?>">Edit</a></h4>
        </div>
        <address>
            <?=$_address->getFirstname()?> <?=$_address->getLastname()?><br/>
            <?if($_address->getCompany()):?><?=$_address->getCompany()?><br/><?endif?>
            <?=$_address->getStreet(1)?><br/>
            <?if($_address->getStreet(2)):?><?=$_address->getStreet(2)?><br/><?endif?>
            <?=$_address->getCity()?>, <?=$_address->getRegion()?> <?=$_address->getPostcode()?><br/>
            <?=$_address->getCountry()?>
            <strong>T</strong> | <?=$_address->getTelephone()?>
        </address>
        <br/>
        <div class="head">
            <h4>Shipping Method</h4>
        </div>
        <?if (!($_shippingRateGroups = $this->getShippingRates($_address))):?>
            <strong><?=__('Sorry, no quotes are available for this order at this time.')?></strong>
        <?else:?>
        <dl class="shipment-methods">
            <?foreach ($_shippingRateGroups as $code => $_rates):?>
                <dt><?=$this->getCarrierName($code)?></dt>
                <dd>
                    <ul>
                    <?foreach ($_rates as $_rate):?>
                        <li>
                           <?if ($_rate->getErrorMessage()):?>
                                <strong><?=$_rate->getCarrierTitle()?>: <?=$_rate->getErrorMessage()?></strong>
                           <?else:?>
                                <input name="shipping_method[<?=$_address->getId()?>]" type="radio" value="<?=$_rate->getCode()?>" id="s_method_<?=$_address->getId()?>_<?=$_rate->getCode()?>"<?if($_rate->getCode()===$this->getAddressShippingMethod($_address)) echo ' checked'?>/>
                                <label for="s_method_<?=$_address->getId()?>_<?=$_rate->getCode()?>"><?=$_rate->getMethodDescription()?> - <strong><?=$_rate->getPrice()?></strong></label>
                           <?endif?>
                        </li>
                    <?endforeach;?>
                    </ul>
                </dd>
            <?endforeach;?>
        </dl>
        <?endif;?>
    </div>
    <div class="col-2">
        <div class="head">
            <h4>Items<span class="separator">|</span><a href="<?=$this->getItemsEditUrl($_address)?>">Edit</a></h4>
        </div>
        <table cellspacing="0" id="shipping-table-<?=$_address->getId()?>" class="data-table nested-table">
            <col/>
            <col width="30"/>
            <thead>
                <tr>
                    <th>Product Name</th>
                    <th class="a-center">Qty</th>
                </tr>
            </thead>
            <tbody>
            <?foreach ($this->getAddressItems($_address) as $_item):?>
                <tr>
                    <td><?=$_item->getQuoteItem()->getName()?></td>
                    <td class="a-center"><?=$_item->getQty()?></td>
                </tr>
            <?endforeach;?>
            </tbody>
        </table>
        <script type="text/javascript">decorateTable('shipping-table-<?=$_address->getId()?>')</script>
    </div>
</div>
<?endforeach;?>
<div class="form-buttons">
    <a href="<?=$this->getBackUrl()?>" class="left">&laquo; Back to Select Addresses</a>
    <button class="form-button" type="submit"><span>Continue</span></button>
</div>
</form>