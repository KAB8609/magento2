<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2004-2007 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<?if(!empty($collection) && $collection->getSize()):?>
	<div class="head">
		<h3><?=__('Customer Reviews')?></h3><?if($reviewCount):?>
		<?if( $this->getUseBackLink() ):?>
		&laquo; <a href="<?=$backLink?>"><?=__('Back')?></a>
		<?else:?>
		( <a href="<?=$reviewLink?>"><?=__('View all')?></a> )
		<?endif;?>
<?endif;?>
	</div>

    <?=$this->getPagerHtml()?>
	<ol>
    <?foreach ($this->getCollection() as $_review):?>
        <li>
        <?if( is_array($_review->getRatingVotes()->getItems()) ):?>
            <?$avarage = 0;?>
            <?foreach( $_review->getRatingVotes()->getItems() as $_vote ):?>
            <?$avarage+= $_vote->getPercent();?>
            <?endforeach;?>
            <?if($_review->getRatingVotes()->getSize()):?>
            <?$avarage = ceil($avarage / $_review->getRatingVotes()->getSize())?>
            <div class="rating-box">
                <div class="rating" style="width:<?=$avarage?>%;"></div>
            </div>
            <?endif;?>
        <?endif;?>
            <a href="#<?=$_review->getTitle()?>" name="<?=$_review->getTitle()?>"><strong><?=$_review->getTitle()?></strong></a> by <em><?=$_review->getNickname()?></em>
            <p class="no-padding"><?=nl2br($_review->getDetail())?></p>
        </li>
    <?endforeach;?>
	</ol>
	<?=$this->getPagerHtml()?>
<?endif;?>