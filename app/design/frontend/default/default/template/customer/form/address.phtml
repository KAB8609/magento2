<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2004-2007 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
?>
<script type="text/javascript">countryRegions = <?=$this->getHelper('directory/data')->getRegionsJs()?></script>

<div class="page-head">
	<h3><?if($data->getAddressId()):?><?=__('Edit Address Entry')?><?else:?><?=__('New Address Entry')?><?endif?></h3>
<?=$this->getMessagesBlock()->getGroupedHtml()?>
<form action="<?=$action?>" method="post" id="form-validate">
<input type="hidden" name="address_id" value="<?=$data->getAddressId()?>">
<input type="hidden" name="customer_id" id="address_id" value="<?=$data->getCustomerId()?>">
    <fieldset class="group-select">
        <h3 class="legend"><?=__('Personal Information')?></h3>
        <ul>
            <li>
                <div class="input-box">
                    <label for="firstname"><?=__('First Name')?> <span class="required">*</span></label><br/>
                    <input type="text" name="firstname" id="firstname" title="<?=__('First Name')?>" value="<?=$data->getFirstname()?>" class="required-entry input-text"/>
                </div>
                <div class="input-box">
                    <label for="lastname"><?=__('Last Name')?> <span class="required">*</span></label><br/>
                    <input type="text" name="lastname" id="lastname" title="<?=__('Last Name')?>" value="<?=$data->getLastname()?>" class="required-entry input-text"/>
                </div>
            </li>
            <li>
                <div class="input-box">
                    <label for="company"><?=__('Company')?></label><br/>
                    <input type="text" name="company" id="company" title="<?=__('Company')?>" value="<?=$data->getCompany()?>" class="input-text"/>
                </div>
            </li>
        </ul>
    </fieldset>
    <fieldset class="group-select">
        <h3 class="legend"><?=__('Address')?></h3>
        <ul>
            <li>
                <label for="street_1"><?=__('Street Address')?> <span class="required">*</span></label><br/>
                <input type="text" name="street[1]" value="<?=$data->getStreet(1)?>" title="<?=__('Street Address')?>" id="street_1" class="required-entry input-text"/>
            </li>
            <li>
                <input type="text" name="street[2]" value="<?=$data->getStreet(2)?>" title="<?=__('Street Address 2')?>" id="street_2" class="input-text"/>
            </li>
            <li>
							<div class="input-box">
                <label for="city"><?=__('City')?> <span class="required">*</span></label><br/>
                <input type="text" name="city" value="<?=$data->getCity()?>"  title="<?=__('City')?>" class="required-entry input-text" id="city"/>
							</div>
							<div class="input-box">
                    <label for="state"><?=__('State/Province')?> <span class="required">*</span></label><br/>
		                <select id="region_id" name="region_id" title="<?=__('State/Province')?>" class="validate-select" style="display:none" defaultValue="<?=$this->getAddress()->getRegionId()?>">
			                	<option value=""><?=__('Please select region, state or province')?></option>
			                </select>
			                <input type="text" id="region" name="region" value="<?=$this->getAddress()->getRegion()?>"  title="<?=__('State/Province')?>" class="required-entry  input-text" style="display:none"/>
							</div>
            </li>
            <li>
                <div class="input-box">
                    <label for="zip"><?=__('Zip/Postal Code')?> <span class="required">*</span></label><br/>
                    <input type="text" name="postcode" value="<?=$data->getPostcode()?>" title="<?=__('Zip/Postal Code')?>" id="zip" class="validate-zip-international required-entry input-text"/>
                </div>
								<div class="input-box">
								<label for="country"><?=__('Country')?> <span class="required">*</span></label><br/>
                <select name="country_id" id="country" title="<?=__('Country')?>" class="validate-select">
                    <?=$countries->toHtmlOptions($data->getCountryId())?>
                </select>
							<div>
            </li>
            <li>
                <div class="input-box">
                    <label for="telephone"><?=__('Telephone')?> <span class="required">*</span></label><br/>
                    <input type="text" name="telephone" value="<?=$data->getTelephone()?>" title="<?=__('Telephone')?>" class="input-text" id="telephone"/></div>
                <div class="input-box">
                    <label for="fax"><?=__('Fax')?></label><br/>
                    <input type="text" name="fax" value="<?=$data->getFax()?>" title="<?=__('Fax')?>" class="input-text" id="fax"/>
                </div>
            </li>
            <?foreach ($primaryTypes as $code=>$type):?>
                <li>
                <?if ($address->isPrimary($type['address_type_id'])):?>
                    <?=__("This is My Primary %s Address", ucfirst($type['name']))?>
                <?else:?>
                    <input type="checkbox" id="primary_<?=$code?>" name="primary_types[]" value="<?=$type['address_type_id']?>"/>&nbsp;
                    <label for="primary_<?=$code?>"><?=__("Use as My Primary %s Address", ucfirst($type['name']))?></label>
                <?endif?>
                </li>
            <?endforeach?>
        </ul>
    </fieldset>
    <div class="form-buttons">
        <p class="required"><?=__('* Required Fields')?></p>
        <a href="<?=$this->getUrl('customer/address')?>" class="left">&laquo; <?=__('Back')?></a>
        <button class="form-button" type="submit"><span><?=__('Save Address')?></span></button>
    </div>
</form>
<script type="text/javascript">
    var dataForm = new VarienForm('form-validate', true);
    //dataForm.setElementsRelation('country', 'state', '<?=$this->getUrl('directory/json/childRegion')?>');
    
    new RegionUpdater('country', 'region', 'region_id', countryRegions);
</script>