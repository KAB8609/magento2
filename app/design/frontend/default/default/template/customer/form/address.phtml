<script type="text/javascript">countryRegions = <?=$this->getHelper('directory/data')->getRegionsJs()?></script>

<div class="page-head">
	<h3><?if($data->getAddressId()):?>Edit<?else:?>New<?endif?> Address Entry</h3>
<?=$this->getMessagesBlock()->getGroupedHtml()?>
<form action="<?=$action?>" method="post" id="form-validate">
<input type="hidden" name="address_id" value="<?=$data->getAddressId()?>">
<input type="hidden" name="customer_id" id="address_id" value="<?=$data->getCustomerId()?>">
    <fieldset class="group-select">
        <h3 class="legend">Personal Information</h3>
        <ul>
            <li>
                <div class="input-box">
                    <label for="firstname">First Name <span class="required">*</span></label><br/>
                    <input type="text" name="firstname" id="firstname" title="First Name" value="<?=$data->getFirstname()?>" class="required-entry input-text"/>
                </div>
                <div class="input-box">
                    <label for="lastname">Last Name <span class="required">*</span></label><br/>
                    <input type="text" name="lastname" id="lastname" title="Last Name" value="<?=$data->getLastname()?>" class="required-entry input-text"/>
                </div>
            </li>
            <li>
                <div class="input-box">
                    <label for="company">Company</label><br/>
                    <input type="text" name="company" id="company" title="Company" value="<?=$data->getCompany()?>" class="input-text"/>
                </div>
            </li>
        </ul>
    </fieldset>
    <fieldset class="group-select">
        <h3 class="legend">Address</h3>
        <ul>
            <li>
                <label for="street_1">Street Address <span class="required">*</span></label><br/>
                <input type="text" name="street[1]" value="<?=$data->getStreet(1)?>" title="Street Address" id="street_1" class="required-entry input-text"/>
            </li>
            <li>
                <input type="text" name="street[2]" value="<?=$data->getStreet(2)?>" title="Street Address 2" id="street_2" class="input-text"/>
            </li>
            <li>
							<div class="input-box">
                <label for="city">City <span class="required">*</span></label><br/>
                <input type="text" name="city" value="<?=$data->getCity()?>"  title="City" class="required-entry input-text" id="city"/>
							</div>
							<div class="input-box">
                    <label for="state">State / Province <span class="required">*</span></label><br/>
		                <select id="region_id" name="region_id" title="<?=__('State / Province')?>" class="validate-select" style="display:none" defaultValue="<?=$this->getAddress()->getRegionId()?>">
			                	<option value=""><?=__('Please select region or state')?></option>
			                </select>
			                <input type="text" id="region" name="region" value="<?=$this->getAddress()->getRegion()?>"  title="<?=__('State / Province')?>" class="required-entry  input-text" style="display:none"/>
							</div>
            </li>
            <li>
                <div class="input-box">
                    <label for="zip">Zip/Post Code <span class="required">*</span></label><br/>
                    <input type="text" name="postcode" value="<?=$data->getPostcode()?>" title="ZIP/Post Code" id="zip" class="validate-zip-international required-entry input-text"/>
                </div>
								<div class="input-box">
								<label for="country">Country <span class="required">*</span></label><br/>
                <select name="country_id" id="country" title="Country" class="validate-select">
                    <?=$countries->toHtmlOptions($data->getCountryId())?>
                </select>
							<div>
            </li>
            <li>
                <div class="input-box">
                    <label for="telephone">Telephone <span class="required">*</span></label><br/>
                    <input type="text" name="telephone" value="<?=$data->getTelephone()?>" title="Telephone" class="input-text" 
                                        id="telephone"/></div>
                <div class="input-box">
                    <label for="fax">Fax</label><br/>
                    <input type="text" name="fax" value="<?=$data->getFax()?>" title="Fax" class="validate-fax input-text" id="fax"/>
                </div>
            </li>
            <?foreach ($primaryTypes as $code=>$type):?>
                <li>
                <?if ($address->isPrimary($type['address_type_id'])):?>
                    <?=__("This is My Primary <strong>%s</strong> Address", $type['name'])?>
                <?else:?>
                    <input type="checkbox" id="primary_<?=$code?>" name="primary_types[]" value="<?=$type['address_type_id']?>"/>&nbsp;
                    <label for="primary_<?=$code?>"><?=__("Use as My Primary <strong>%s</strong> Address", $type['name'])?></label>
                <?endif?>
                </li>
            <?endforeach?>
        </ul>
    </fieldset>
    <div class="form-buttons">
        <p class="required">* Required Fields</p>
        <a href="<?=$baseUrl?>customer/address/" class="left">&laquo; Back</a>
        <button class="form-button" type="submit"><span>Save Address</span></button>
    </div>
</form>
<script type="text/javascript">
    var dataForm = new VarienForm('form-validate', true);
    //dataForm.setElementsRelation('country', 'state', '<?=$baseUrl?>directory/json/childRegion/');
    
    new RegionUpdater('country', 'region', 'region_id', countryRegions);
</script>
