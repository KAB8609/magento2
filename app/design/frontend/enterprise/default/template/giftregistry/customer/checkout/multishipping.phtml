<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2009 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>

<?php if ($this->getEnabled() && $this->getGiftRegistryQuoteItems()) :?>
<script type="text/javascript">
//<![CDATA[
    function addOption(item, address) {
        var select;
        Form.getElements('checkout_multishipping_form').each(function(element) {
            if (element.type == 'select-one') {
                arr = element.id.split('_');
                if (arr[2] && arr[2] == item) {
                    select = element;
                }
            }
        });

        if (select) {
            var option = document.createElement('OPTION');
            option.value = '<?php echo $this->getAddressIdPrefix(); ?>' + address;
            option.text = '<?php echo $this->__('Use gift registry shipping address') ?>';

            if (select.options.add) {
                select.options.add(option);
            } else {
                select.appendChild(option);
            }

            var qtyElement = select.up('tr').down('input[type="text"]');
            Event.observe(qtyElement, 'change', function(){
                qtyElement.value = qtyElement.defaultValue;
                alert('<?php echo $this->__('It is not possible to change quantity for gift registry items') ?>')
            });
        }
    }

    <?php foreach ($this->getGiftRegistryQuoteItems() as $itemId => $registryItemId) : ?>
        addOption(<?php echo $itemId; ?>, <?php echo $registryItemId; ?>);
    <?php endforeach; ?>
//]]>
</script>
<?php endif; ?>
