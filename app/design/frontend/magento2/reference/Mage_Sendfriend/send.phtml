<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     magento2_reference
 * @copyright   {copyright}
 * @license     {license_link}
 */
/* @var $this Mage_Sendfriend_Block_Send */
/**
 * Send to friend form
 *
 * @see Mage_Sendfriend_Block_Send
 */
?>
<script id="add-recipient-tmpl" type="text/x-jQuery-tmpl">
    <a href="delete_email"  id="btn-remove${_index_}" class="action delete" title="<?php echo $this->jsQuoteEscape($this->__('Remove Email')) ?>"><span><?php echo $this->jsQuoteEscape($this->__('Remove Email')) ?></span></a>

    <div class="field name required">
        <label for="recipients-name${_index_}" class="label"><?php echo $this->__('Name:')?></label>
        <div class="control">
            <input name="recipients[name][${_index_}]" type="text" title="<?php echo $this->__('Name:')?>" class="input-text" id="recipients-name${_index_}" data-validate="{required:true}"/>
        </div>
    </div>

    <div class="field email required">
        <label for="recipients-email${_index_}" class="label"><?php echo $this->__('Email Address:') ?></label>
        <div class="control">
            <input name="recipients[email][${_index_}]" title="<?php echo $this->__('Email Address:') ?>" id="recipients-email${_index_}" type="text" class="input-text" data-validate="{required:true, 'validate-email':true}"/>
        </div>
    </div>
</script>

<form action="<?php echo $this->getSendUrl() ?>" method="post" id="product-sendtofriend-form" class="form send friend" data-hasRequired="<?php echo $this->__('* Required Fields') ?>">
    <fieldset class="fieldset sender" id="sender_options">
        <?php echo $this->getBlockHtml('formkey')?>
        <legend class="legend"><span><?php echo $this->__('Sender:') ?></span></legend>
        <br>
        <div class="field sender required">
            <label for="sender-name" class="label"><span><?php echo $this->__('Name:') ?></span></label>
            <div class="control">
                <input name="sender[name]" value="<?php echo $this->escapeHtml($this->getUserName()) ?>" title="<?php echo $this->__('Name') ?>" id="sender-name" type="text" class="input-text" data-validate="{required:true}"/>
            </div>
        </div>

        <div class="field email required">
            <label for="sender-email" class="label"><span><?php echo $this->__('Email:') ?></span></label>
            <div class="control">
                <input name="sender[email]" value="<?php echo $this->escapeHtml($this->getEmail()) ?>" title="<?php echo $this->__('Email Address') ?>" id="sender-email" type="text" class="input-text" data-validate="{required:true, 'validate-email':true}"/>
            </div>
        </div>

        <div class="field text required">
            <label for="sender-message" class="label"><span><?php echo $this->__('Message:') ?></span></label>
            <div class="control">
                <textarea name="sender[message]" class="input-text" id="sender-message" cols="3" rows="3" data-validate="{required:true}"><?php echo $this->escapeHtml($this->getMessage())?></textarea>
            </div>
        </div>
    </fieldset>

    <fieldset class="fieldset recipients" id="recipients-options">
        <?php echo $this->getBlockHtml('formkey')?>
        <legend class="legend"><span><?php echo $this->__('Recipient:') ?></span></legend><br />
    </fieldset>
    <div class="actions">
        <div class="primary">
            <button type="submit" class="action submit"<?php if (!$this->canSend()):?> disabled="disabled"<?php endif ?>><span><?php echo $this->__('Send Email') ?></span></button>
            <div id="max-recipient-message" style="display:none;" class="notice-msg limit">
                <?php if ($this->getMaxRecipients()): ?>
                <span><?php echo $this->__('Maximum %d email addresses allowed.', $this->getMaxRecipients()) ?></span>
                <?php endif; ?>
            </div>
            <?php if (1 < $this->getMaxRecipients()): ?>
                <button type="button" id="add-recipient-button" class="action add"><span><?php echo $this->__('Add Recipient') ?></span></button>
            <?php endif; ?>
        </div>
        <div class="secondary">
            <a class="action back" href="#" role="back"><span><?php echo $this->__('Back') ?></span></a>
        </div>
    </div>
</form>
<script type="text/javascript">
    (function($) {
        head.js("<?php echo $this->getViewFileUrl('jquery/jquery.validate.js')?>",
            "<?php echo $this->getViewFileUrl('jquery/jquery.metadata.js')?>",
            "<?php echo $this->getViewFileUrl('mage/validation.js')?>",
            "<?php echo $this->getViewFileUrl('mage/validation/validation.js')?>",
            "<?php echo $this->getViewFileUrl('Mage_Page::js/row-builder.js')?>", function() {
                $('#product-sendtofriend-form').rowBuilder({
                    rowTemplate: '#add-recipient-tmpl',
                    rowContainer: '#recipients-options',
                    rowParentElem: '<div></div>',
                    btnRemoveSelector: '.action.delete',
                    maxRows: '<?php echo $this->getMaxRecipients() ?>',
                    maxRowsMsg: '#max-recipient-message',
                    addRowBtn: '#add-recipient-button',
                    additionalRowClass: 'additional'
                }).validation();
                $('a[role="back"]').on('click', function() { history.back(); return false; });
            })
    })(jQuery);
</script>
