<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     magento2_reference
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php
/**
 * Product list template
 *
 * @see Mage_Catalog_Block_Product_List
 */
?>
<?php
$_productCollection = $this->getLoadedProductCollection();
$_helper = $this->helper('Mage_Catalog_Helper_Output');
$imageBlock =  $this->getLayout()->createBlock('Mage_Catalog_Block_Product_Image');
?>
<?php if (!$_productCollection->count()): ?>
<p class="message note"><?php echo $this->__('There are no products matching the selection.') ?></p>
<?php else: ?>
<?php echo $this->getToolbarHtml() ?>
<?php echo $this->getAdditionalHtml() ?>
<?php if ($this->getMode() == 'grid') {
    $viewMode ='grid';
    $image = 'category_page_grid';
    $showDescription = false;
    $rating = 'short';
} else {
    $viewMode ='list';
    $image = 'category_page_list';
    $showDescription = true;
    $rating = 'full';
}
/**
* Position for actions regarding image size changing in vde if needed
*/
$pos = $this->getPositioned();
$position = '';
if ($pos != null) {
    $position = ' style="left:' . $this->getVar("{$image}:width") . 'px;'
                .'top:' . $this->getVar("{$image}:height") . 'px;"';
}
?>
<div class="products wrapper <?php echo $viewMode; ?>">
    <?php $iterator = 1; ?>
    <ol class="products list items">
        <?php foreach ($_productCollection as $_product): ?>
        <?php echo ($iterator++==1) ? '<li class="item product">' : '</li><li class="item product">' ?>
            <div class="product">
                <?php // Product Image ?>
                <a href="<?php echo $_product->getProductUrl() ?>" class="product photo">
                    <?php echo $imageBlock->init($_product, $image)->toHtml() ?>
                </a>
                <div class="product details">
                    <?php $_productNameStripped = $this->stripTags($_product->getName(), null, true); ?>
                    <strong class="product name">
                        <a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $_productNameStripped; ?>">
                            <?php echo $_helper->productAttribute($_product, $_product->getName(), 'name'); ?>
                        </a>
                    </strong>
                    <?php echo $this->getPriceHtml($_product, true) ?>
                    <?php if ($_product->getRatingSummary()): ?>
                    <?php echo $this->getReviewsSummaryHtml($_product,$rating) ?>
                    <?php endif; ?>
                    <?php if ($showDescription):?>
                    <div class="product description">
                        <?php echo $_helper->productAttribute($_product, $_product->getShortDescription(), 'short_description') ?>
                        <a href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $_productNameStripped ?>"
                           class="action more"><?php echo $this->__('Learn More') ?></a>
                    </div>
                    <?php endif; ?>
                    <div class="product actions"<?php echo strpos($pos, $viewMode . '-actions') ? $position : ''; ?>>
                        <div class="primary"<?php echo strpos($pos, $viewMode . '-primary') ? $position: ''; ?>>
                            <?php if ($_product->isSaleable()): ?>
                            <button type="button" title="<?php echo $this->__('Add to Cart') ?>" class="action tocart"
                                    data-mage-redirect="{event: 'click', url: '<?php echo $this->getAddToCartUrl($_product) ?>'}">
                                <span><?php echo $this->__('Add to Cart') ?></span>
                            </button>
                            <?php else: ?>
                            <?php if ($_product->getIsSalable()): ?>
                                <p class="stock available"><span><?php echo $this->__('In stock') ?></span></p>
                                <?php else: ?>
                                <p class="stock unavailable"><span><?php echo $this->__('Out of stock') ?></span></p>
                                <?php endif; ?>
                            <?php endif; ?>
                        </div>
                        <div class="secondary"<?php echo strpos($pos, $viewMode . '-secondary') ? $position : ''; ?>>
                            <a href="<?php echo $this->helper('Mage_Wishlist_Helper_Data')->getAddUrl($_product) ?>"
                               class="action towishlist">
                               <span><?php echo $this->__('Add to Wishlist') ?></span>
                           </a>
                            <a href="<?php echo $this->getAddToCompareUrl($_product) ?>" class="action tocompare">
                                <span><?php echo $this->__('Add to Compare') ?></span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        <?php echo ($iterator==count($_productCollection)+1) ? '</li>' : '' ?>
        <?php endforeach; ?>
    </ol>
    <script type="text/javascript">
        head.js("<?php echo $this->getViewFileUrl('Mage_Catalog::js/mage-attributes-processing.js') ?>");
    </script>
</div>
<div class="toolbar bottom">
    <?php echo $this->getToolbarHtml() ?>
</div>
<?php endif; ?>
