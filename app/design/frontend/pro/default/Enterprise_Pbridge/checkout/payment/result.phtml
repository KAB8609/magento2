<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     pro_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<script type="text/javascript">
//<![CDATA[
    var paymentObj = parent.payment;
    function setPaymentMethod()
    {
        var jsonParams = <?php echo $this->getJsonHiddenPbridgeParams() ?>;
        if (jsonParams.original_payment_method) {
            var containerElement = parent.document.getElementById('payment_form_pbridge_' + jsonParams.original_payment_method);
            if (!containerElement) {
                containerElement = parent.document.getElementById('payment_form_' + jsonParams.original_payment_method);
            }
            var listElements = containerElement.getElementsByTagName('LI');
            if (listElements.length) {
                containerElement = listElements[0];
            }
            var methodParam;
            parent.$H(jsonParams).each(function(param) {
                var paramId = 'pbridge_' + jsonParams.original_payment_method + '_' + param.key;
                var methodParam = parent.document.getElementById(paramId);

                if (methodParam) {
                    methodParam.setAttribute('value', param.value);
                } else {
                    methodParam = parent.document.createElement('input');
                    methodParam = parent.$(methodParam);
                    var attrs = {
                        'id':    paramId,
                        'type':  'hidden',
                        'name':  'payment[pbridge_data][' + param.key + ']',
                        'value': param.value
                    };
                    for (var name in attrs) methodParam.setAttribute(name, attrs[name]);
                    containerElement.appendChild(methodParam);
                }
            });
            try {
                paymentObj.save();
                var buttonsContainer = parent.document.getElementById('payment-buttons-container');
                var continueButton = buttonsContainer.getElementsByTagName('BUTTON');
                if (continueButton.length) {
                    continueButton = continueButton[0];
                }
                if (buttonsContainer && continueButton) {
                    continueButton.style.display = '';
                }
            } catch (e) {}
        }
        var message = document.getElementById('payment-method-message');
        message.innerHTML = '<?php echo Mage::helper('Enterprise_Pbridge_Helper_Data')->__('Payment Bridge Selected') ?>';
    }
    window.onload = setPaymentMethod;
//]]>
</script>

<div id="payment-method-message"></div>
