<?php
/**
 * {license_notice}
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   {copyright}
 * @license     {license_link}
 */
?>
<?php /** @var $this \Magento\Checkout\Block\Multishipping\Overview */ ?>
<div class="page-title">
    <h1><?php echo __('Review Order') ?></h1>
</div>
<?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
<form action="<?php echo $this->getPostActionUrl() ?>" method="post" id="review-order-form">
<fieldset class="multiple-checkout">
    <div class="col2-set">
        <h2 class="sub-title"><?php echo __('Billing Information') ?></h2>
        <div class="col-1 narrow">
            <div class="info-box">
                <?php $_address=$this->getBillingAddress() ?>
                <h3 class="box-title"><?php echo __('Billing Address') ?> <span class="separator">|</span> <a href="<?php echo $this->getEditBillingAddressUrl($_address) ?>"><?php echo __('Change') ?></a></h3>
                <address class="box-content">
                    <?php echo $_address->format('html') ?>
                </address>
            </div>
        </div>
        <div class="col-2 wide">
            <div class="info-box">
                <h3 class="box-title"><?php echo __('Payment Method') ?> <span class="separator">|</span> <a href="<?php echo $this->getEditBillingUrl() ?>"><?php echo __('Change') ?></a></h3>
                <div class="box-content">
                    <input type="hidden" name="payment[cc_number]" value="<?php echo $this->escapeHtml($this->getPayment()->getCcNumber())?>" />
                    <input type="hidden" name="payment[cc_cid]" value="<?php echo $this->escapeHtml($this->getPayment()->getCcCid())?>" />
                    <?php echo $this->getPaymentHtml() ?>
                </div>
            </div>
        </div>
     </div>
    <h2 class="sub-title"><?php echo __('Shipping Information') ?></h2>
    <?php $mergedCells = ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices() ? 2 : 1); ?>
    <?php foreach ($this->getShippingAddresses() as $_index => $_address): ?>
        <div class="col2-set">
            <h3 class="section-title"><?php echo __('Address %1 of %2', ($_index+1), $this->getShippingAddressCount()) ?></h3>
            <div class="col-1 narrow">
                <div class="info-box">
                    <h4 class="box-title"><?php echo __('Shipping To') ?> <span class="separator">|</span> <a href="<?php echo $this->getEditShippingAddressUrl($_address) ?>"><?php echo __('Change') ?></a></h4>
                    <address class="box-content">
                        <?php echo $_address->format('html') ?>
                    </address>
                </div>
                <div class="info-box">
                    <h4 class="box-title"><?php echo __('Shipping Method') ?> <span class="separator">|</span> <a href="<?php echo $this->getEditShippingUrl() ?>"><?php echo __('Change') ?></a></h4>
                    <?php if($_rate=$this->getShippingAddressRate($_address)): ?>
                    <p class="box-content">
                    <?php echo $this->escapeHtml($_rate->getCarrierTitle()) ?> (<?php echo $this->escapeHtml($_rate->getMethodTitle()) ?>)
                    <?php $_excl = $this->getShippingPriceExclTax($_address); ?>
                    <?php $_incl = $this->getShippingPriceInclTax($_address); ?>

                    <?php echo $_excl; ?>
                    <?php if ($this->helper('\Magento\Tax\Helper\Data')->displayShippingBothPrices() && $_incl != $_excl): ?>
                        (<?php echo __('Incl. Tax'); ?> <?php echo $_incl; ?>)
                    <?php endif; ?>
                    </p>
                    <?php endif; ?>
                </div>
            </div>
            <div class="col-2 wide">
                <h4 class="table-caption"><?php echo __('Items') ?> <span class="separator">|</span> <a href="<?php echo $this->getAddressesEditUrl() ?>"><?php echo __('Edit Items') ?></a></h4>
                <table class="data-table" id="overview-table-<?php echo $_address->getId() ?>">
                    <col />
                    <col width="1" />
                    <?php if ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices()): ?>
                    <col width="1" />
                    <?php endif; ?>
                    <col width="1" />
                    <col width="1" />
                    <?php if ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices()): ?>
                    <col width="1" />
                    <?php endif; ?>
                    <thead>
                        <tr>
                            <th rowspan="<?php echo $mergedCells; ?>"><?php echo __('Product Name') ?></th>
                            <th colspan="<?php echo $mergedCells; ?>" class="a-center"><?php echo __('Price') ?></th>
                            <th rowspan="<?php echo $mergedCells; ?>"><?php echo __('Qty') ?></th>
                            <th colspan="<?php echo $mergedCells; ?>" class="a-center"><?php echo __('Subtotal') ?></th>
                        </tr>
                        <?php if ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices()): ?>
                        <tr>
                            <th class="a-right"><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(false) ?></th>
                            <th><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(true) ?></th>
                            <th class="a-right"><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(false) ?></th>
                            <th><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(true) ?></th>
                        </tr>
                        <?php endif; ?>
                    </thead>
                    <tfoot>
                    <?php echo $this->renderTotals($this->getShippingAddressTotals($_address)); ?>
                    </tfoot>
                    <tbody>
                    <?php foreach ($this->getShippingAddressItems($_address) as $_item): ?>
                        <?php echo $this->getRowItemHtml($_item); ?>
                    <?php endforeach; ?>
                    </tbody>
                </table>
                <script type="text/javascript">jQuery('#overview-table-<?php echo $_address->getId() ?>').decorate('table')</script>
            </div>
        </div>
        <?php if($this->getShippingAddressCount()!=$_index+1): ?>
        <?php endif; ?>
    <?php endforeach; ?>

    <?php if ($this->getQuote()->hasVirtualItems()): ?>
    <h2 class="sub-title"><?php echo __('Other items in your order') ?></h2>
    <div class="col2-set">
        <div class="col-1 narrow"></div>
        <div class="col-2 wide">
            <h3 class="table-caption"><?php echo __('Items') ?> <span class="separator">|</span> <a href="<?php echo $this->getVirtualProductEditUrl() ?>"><?php echo __('Edit Items') ?></a></h3>
            <?php $mergedCells = ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices() ? 2 : 1); ?>
            <table class="data-table" id="virtual-overview-table">
                <col />
                <col width="1" />
                <?php if ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices()): ?>
                <col width="1" />
                <?php endif; ?>
                <col width="1" />
                <col width="1" />
                <?php if ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices()): ?>
                <col width="70" />
                <?php endif; ?>
                <thead>
                    <tr>
                        <th rowspan="<?php echo $mergedCells; ?>"><?php echo __('Product Name') ?></th>
                        <th colspan="<?php echo $mergedCells; ?>" class="a-center"><?php echo __('Price') ?></th>
                        <th rowspan="<?php echo $mergedCells; ?>"><?php echo __('Qty') ?></th>
                        <th colspan="<?php echo $mergedCells; ?>" class="a-center"><?php echo __('Subtotal') ?></th>
                    </tr>
                    <?php if ($this->helper('\Magento\Tax\Helper\Data')->displayCartBothPrices()): ?>
                    <tr>
                        <th class="a-right"><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(false) ?></th>
                        <th><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(true) ?></th>
                        <th class="a-right"><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(false) ?></th>
                        <th><?php echo $this->helper('\Magento\Tax\Helper\Data')->getIncExcTaxLabel(true) ?></th>
                    </tr>
                    <?php endif; ?>
                </thead>
                <tfoot>
                    <?php echo $this->renderTotals($this->getBillinAddressTotals()); ?>
                </tfoot>
                <tbody>
                <?php foreach ($this->getVirtualItems() as $_item): ?>
                    <?php echo $this->getRowItemHtml($_item); ?>
                <?php endforeach; ?>
                </tbody>
                </table>
                <script type="text/javascript">jQuery('#virtual-overview-table').decorate('table')</script>
            </div>
    </div>
    <?php endif; ?>

    <?php echo $this->getChildHtml('items_after'); ?>

    <div id="checkout-review-submit">
        <?php echo $this->getChildHtml('agreements') ?>
        <p class="grand-total"><strong class="price-label"><?php echo __('Grand Total:') ?></strong> <?php echo $this->helper('\Magento\Checkout\Helper\Data')->formatPrice($this->getTotal()) ?></p>
        <div class="buttons-set" id="review-buttons-container">
            <button type="submit" class="button" id="review-button"><span><span><?php echo __('Place Order') ?></span></span></button>
            <span id="review-please-wait" class="please-wait" style="display:none;">
                <img src="<?php echo $this->getViewFileUrl('images/opc-ajax-loader.gif') ?>" alt="" class="v-middle" /> <?php echo __('Submitting order information...') ?>
            </span>
        </div>
    </div>
    <p class="back-link"><a href="<?php echo $this->getBackUrl() ?>"><small>&laquo; </small><?php echo __('Back to Billing Information') ?></a></p>
</fieldset>
</form>
<script type="text/javascript">
    head.js("<?php echo $this->getViewFileUrl('Magento_Checkout::js/overview.js')?>", function() {
        jQuery('#review-order-form').orderOverview();
    });
</script>
