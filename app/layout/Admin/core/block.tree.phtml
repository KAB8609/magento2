<div id="block:tree"></div>
<script>
Ext.onReady(function(){
    // shorthand
    var Tree = Ext.tree;
    
    var tree = new Tree.TreePanel('block:tree', {
        animate:true, 
        loader: new Tree.TreeLoader({dataUrl:'<?=$this->BASE_URL?>/block/node/'}),
        enableDD:true,
        containerScroll: true
    });

    var menuC = new Ext.menu.Menu({
    	id : 'mainContext',
        items: [{
        		text: 'Show Products',
        		handler: ondblClick
        	}, '-',  {
        		text: 'Edit'
        	}, {
        		text: 'Delete'
        	}]
    });

	function menuShow (node){
            menuC.show(node.ui.getEl(), 'tr-tr');
    } 


    tree.on('dblclick', Ext.Varien.Blocks.edit, Ext.Varien.Blocks);
    
    function ondblClick(node, e) {
        var mainLayout = Admin.getLayout();
        mainLayout.beginUpdate();
        if (!Ext.get('catalog_productsGrid_category_'+node.id)) {
            var divHolder = document.createElement('div');
            divHolder.id = 'catalog_productsGrid_category_'+node.id;
            document.body.appendChild(divHolder);
        }
        mainLayout.add('center', new Ext.ContentPanel('catalog_productsGrid_category_'+node.id, {closable: true, title:'Grid - ' + node.text, fitToFrame: true, url:BASE_URL + '/mage_catalog/product/grid/category/'+node.id, loadOnce: true }));
        mainLayout.endUpdate();
    }
    
    // set the root node
    var root = new Tree.AsyncTreeNode({
        text: 'Blocks',
        draggable:false,
        id:'1'
    });
    tree.setRootNode(root);

	root.on('contextmenu', menuShow, root);    
    // render the tree
    tree.render();

    //root.expand();
});
</script>