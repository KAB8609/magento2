<script type="text/javascript" language="javascript">
if (!Mage.Collection.get('category_tree_context_menu'))
{
    var categoryTreeContextMenuHandler = new Object();
    categoryTreeContextMenuHandler.showProducts = function(item,event){
        alert('show products');
    };
    categoryTreeContextMenuHandler.editCategory = function(item,event){
        alert('edit category');
    };
    categoryTreeContextMenuHandler.deleteCategory = function(item,event){
        alert('delete category');
    };

    var categoryTreeContextMenu = new Ext.menu.Menu({
        id : 'category_context_menu',
        items: [{text: 'Show Category Products',handler:categoryTreeContextMenuHandler.showProducts}, 
                '-',  
                {text: 'Edit Catecory',handler:categoryTreeContextMenuHandler.editCategory}, 
                {text: 'Delete Category',handler:categoryTreeContextMenuHandler.deleteCategory}]
    });
    
    categoryTreeContextMenu.showNodeContextMenu = function(node, event){
        node.select();
        this.show(node.ui.getEl(),'tr-tr');
    };
    Mage.Collection.add('category_tree_context_menu', categoryTreeContextMenu);
    Mage.Collection.add('category_tree_context_menu_handler', categoryTreeContextMenuHandler);
}

Mage.Collection.get('catalog_category_tree').addListener(
    'contextmenu',
    Mage.Collection.get('category_tree_context_menu').showNodeContextMenu,
    Mage.Collection.get('category_tree_context_menu')
);

function moveNode(e) {
    Ext.dump(e.target.id);
    Ext.dump(e.point);
    Ext.dump(e.dropNode.id);
    Ext.dump('===================================');
}
var root = Mage.Collection.get('catalog_tree');
root.addListener('beforenodedrop', moveNode);
</script>
