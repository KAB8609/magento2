<?xml version="1.0" encoding="UTF-8"?>
<project name="magento">
    
    <target name="install" description="Installing Magento instance.">
        <exec executable="/bin/sh" failonerror="true">
    	    <arg value="install.sh"/>
    	    <arg value="${teamcity.buildConfName}"/>
            <arg value="${build.number}"/>
	</exec>
    </target>
    
    <target name="prepare-env" description="prepare basic (clean) ENV for instance.">
        <exec executable="/bin/sh" failonerror="true">
            <arg value="prepare.sh"/>
            <arg value="${teamcity.buildConfName}"/>
            <arg value="${build.number}"/>
        </exec>
    </target>
    
    <target name="prepare-env-previous" depends="prepare-env" description="Prepare ENV (DB, websites folder) from previous instance.">
        <exec executable="/bin/sh" failonerror="true">
            <arg value="prepare-previous.sh"/>
            <arg value="${teamcity.buildConfName}"/>
            <arg value="${build.number}"/>
        </exec>
    </target>
    
    <target name="prepare-env-sample-data-ce" depends="prepare-env" description="Prepare ENV with sample data for CE instance."/>
    <target name="prepare-env-sample-data-ee" depends="prepare-env" description="Prepare ENV with sample data for EE instance."/>
    <target name="prepare-env-sample-data-pe" depends="prepare-env" description="Prepare ENV with sample data for PE instance."/>

    <target name="brutetest" description="Basic validation for Magento installation.">
        <exec executable="/bin/sh" failonerror="true">
            <arg value="brutetest.sh"/>
            <arg value="${teamcity.buildConfName}"/>
            <arg value="${build.number}"/>
        </exec>	
    </target>
    
    <target name="finalize" description="Update 'current' symlink and successful in scope of build name.">
        <exec executable="/bin/sh" failonerror="true">
            <arg value="finalize.sh"/>
            <arg value="${teamcity.buildConfName}"/>
            <arg value="${build.number}"/>
        </exec> 
    </target>
    
    <target name="archive-builds" description="Arcvhive all builds in scope of build name.">
	<exec executable="/bin/sh" failonerror="true">
            <arg value="archive.sh"/>
            <arg value="${teamcity.buildConfName}"/>
            <arg value="${build.number}"/>
        </exec>    
    </target>

    <!-- targets to clean current checkout for specific build type -->
    <target name="prepare-trunk" description="Prepare trunk checkout.">
        <copy file="XEnterprise_Enabler.xml" tofile="${teamcity.build.checkoutDir}/app/etc/modules/XEnterprise_Enabler.xml" failonerror="true"/>
    </target>
    <target name="prepare-ce" description="Prepare CE checkout (remove unneed files, etc)"/>
    <target name="prepare-ee" description="Prepare EE checkout (remove unneed files, fix license, etc)"/>
    <target name="prepare-pe" description="Prepare PE checkout (remove unneed files, fix licemse, etc)"/>
    
    <target name="tag" description="Create tag for this build."/>

    <target name="nightly-build" description="Installs Magento nightly build." depends="prepare-env-previous, install, brutetest, finalize, archive-builds"/>

</project>
