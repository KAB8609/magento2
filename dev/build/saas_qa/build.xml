<?xml version="1.0" encoding="utf-8"?>
<!--
/**
 * {license_notice}
 *
 * @copyright  {copyright}
 * @license    {license_link}
 */
-->
<project name="SaaS QA Builds" basedir="../../../" default="multitenant_deployment">
    <property environment="env"/>
    <target name="multitenant_deployment" description="Basic multi-tenant environment QA setup">
        <fail unless="env.db_host" message="'db_host' must be defined"/>
        <fail unless="env.db_user" message="'db_user' must be defined"/>
        <fail unless="env.db_password" message="'db_password' must be defined"/>
        <fail unless="env.multitenant_url_template" message="'multitenant_url_template' must be defined"/>
        <condition property="env.bamboo_install_ids" value="">
            <not><isset property="env.bamboo_install_ids"/></not>
        </condition>
        <condition property="env.bamboo_uninstall_ids" value="">
            <not><isset property="env.bamboo_uninstall_ids"/></not>
        </condition>

        <antcall>
            <param name="license_replacement_enabled" value="true"/>
            <param name="product_edition_code" value="saas"/>
            <target name="_product_edition"/>
        </antcall>

        <exec executable="php" failonerror="true">
            <arg line="-f ${basedir}/dev/build/saas_qa/deploy.php --
                --url-template=${env.multitenant_url_template}
                --install=${env.bamboo_install_ids} --uninstall=${env.bamboo_uninstall_ids}
                --dsn=mysql://${env.db_user}:${env.db_password}@${env.db_host}
                "/>
        </exec>
    </target>
</project>
